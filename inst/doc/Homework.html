<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="by 20054" />

<meta name="date" content="2020-12-21" />

<title>Homework-2020.12.24</title>

<script>// Hide empty <a> tag within highlighted CodeBlock for screen reader accessibility (see https://github.com/jgm/pandoc/issues/6352#issuecomment-626106786) -->
// v0.0.1
// Written by JooYoung Seo (jooyoung@psu.edu) and Atsushi Yasumoto on June 1st, 2020.

document.addEventListener('DOMContentLoaded', function() {
  const codeList = document.getElementsByClassName("sourceCode");
  for (var i = 0; i < codeList.length; i++) {
    var linkList = codeList[i].getElementsByTagName('a');
    for (var j = 0; j < linkList.length; j++) {
      if (linkList[j].innerHTML === "") {
        linkList[j].setAttribute('aria-hidden', 'true');
      }
    }
  }
});
</script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Homework-2020.12.24</h1>
<h4 class="author"><em>by 20054</em></h4>
<h4 class="date">2020-12-21</h4>



<div id="section" class="section level2">
<h2>2020/9/22</h2>
</div>
<div id="question" class="section level2">
<h2>Question</h2>
<ol style="list-style-type: decimal">
<li>Go through “R for Beginners” if you are not familiar with R programming.</li>
<li>Use knitr to produce 3 examples in the book. The 1st example should contain texts and at least one figure. The 2nd example should contains texts and at least one table. The 3rd example should contain at least a couple of LaTeX formulas.</li>
</ol>
</div>
<div id="answer" class="section level2">
<h2>Answer</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">sunflowerplot</span>(pressure)</span></code></pre></div>
<div id="年18月份全国房地产开发投资和销售情况如下" class="section level3">
<h3>2020年1—8月份全国房地产开发投资和销售情况如下：</h3>
<p>1—8月份，全国房地产开发投资88454亿元，同比增长4.6%， 增速比1—7月份提高1.2个百分点。其中，住宅投资65454亿元，增长5.3%，增速提高1.2个百分点。</p>
<p>全国房地产开发投资增速如下：</p>
<table>
<thead>
<tr class="header">
<th>年份</th>
<th>增速（%）</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2020年1-2月</td>
<td>-16.3</td>
</tr>
<tr class="even">
<td>2020年1-3月</td>
<td>-7.7</td>
</tr>
<tr class="odd">
<td>2020年1-4月</td>
<td>-3.3</td>
</tr>
<tr class="even">
<td>2020年1-5月</td>
<td>-0.3</td>
</tr>
<tr class="odd">
<td>2020年1-6月</td>
<td>1.9</td>
</tr>
<tr class="even">
<td>2020年1-7月</td>
<td>3.4</td>
</tr>
<tr class="odd">
<td>2020年1-8月</td>
<td>4.6</td>
</tr>
</tbody>
</table>
<p>3.数学公式如下：</p>
<p><span class="math inline">\(\int_{0}^{1-\beta}dx\int_{x+\beta}^{1}n(n-1)(y-x)dy=1-n\beta^{n-1}+(n-1)\beta^n\)</span></p>
<p><span class="math inline">\(Var(nF_n(x))=nF(x)(1-F(x))\)</span></p>
</div>
</div>
<div id="section-1" class="section level2">
<h2>2020/9/29</h2>
</div>
<div id="question-1" class="section level2">
<h2>Question</h2>
<p>Exercises 3.3, 3.9, 3.10, and 3.13 (pages 94-95, Statistical Computating with R).</p>
<p><span class="math inline">\(3.3 \quad\)</span> The Pareto <span class="math inline">\((a, b)\)</span> distribution has cdf <span class="math display">\[
F(x)=1-\left(\frac{b}{x}\right)^{a}, \quad x \geq b&gt;0, a&gt;0
\]</span> Derive the probability inverse transformation <span class="math inline">\(F^{-1}(U)\)</span> and use the inverse transform method to simulate a random sample from the Pareto( 2,2 ) distribution. Graph the density histogram of the sample with the Pareto( 2,2<span class="math inline">\()\)</span> density superimposed for comparison.</p>
<p><span class="math inline">\(3.9 \quad\)</span> The rescaled Epanechnikov kernel [85] is a symmetric density function <span class="math display">\[
f_{e}(x)=\frac{3}{4}\left(1-x^{2}\right), \quad|x| \leq 1
\]</span> Devroye and Györfi [71, p. 236] give the following algorithm for simulation from this distribution. Generate id <span class="math inline">\(U_{1}, U_{2}, U_{3} \sim\)</span> Uniform <span class="math inline">\((-1,1) .\)</span> If <span class="math inline">\(\left|U_{3}\right| \geq\)</span> <span class="math inline">\(\left|U_{2}\right|\)</span> and <span class="math inline">\(\left|U_{3}\right| \geq\left|U_{1}\right|,\)</span> deliver <span class="math inline">\(U_{2} ;\)</span> otherwise deliver <span class="math inline">\(U_{3} .\)</span> Write a function to generate random variates from <span class="math inline">\(f_{e},\)</span> and construct the histogram density estimate of a large simulated random sample.</p>
<p><span class="math inline">\(3.10 \quad\)</span> Prove that the algorithm given in Exercise 3.9 generates variates from the density <span class="math inline">\(f_{e}(3.10)\)</span></p>
<p><span class="math inline">\(3.13 \quad\)</span> It can be shown that the mixture in Exercise 3.12 has a Pareto distribution with cdf <span class="math display">\[
F(y)=1-\left(\frac{\beta}{\beta+y}\right)^{r}, \quad y \geq 0
\]</span> (This is an alternative parameterization of the Pareto cdf given in Exercise 3.3.) Generate 1000 random observations from the mixture with <span class="math inline">\(r=4\)</span> and <span class="math inline">\(\beta=2 .\)</span> Compare the empirical and theoretical (Pareto) distributions by graphing the density histogram of the sample and superimposing the Pareto density curve.</p>
</div>
<div id="answer-1" class="section level2">
<h2>Answer</h2>
<p><span class="math inline">\(3.3 \quad\)</span></p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>n &lt;-<span class="st"> </span><span class="dv">1000</span></span>
<span id="cb2-2"><a href="#cb2-2"></a>u &lt;-<span class="st"> </span><span class="kw">runif</span>(n)<span class="co">#设置随机数</span></span>
<span id="cb2-3"><a href="#cb2-3"></a>x &lt;-<span class="st"> </span><span class="dv">2</span><span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>u)<span class="op">^</span>(<span class="op">-</span>(<span class="dv">1</span><span class="op">/</span><span class="dv">2</span>)) <span class="co"># U=1-(2/X)^2，X=2*(1-U)^(1/2)</span></span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="kw">hist</span>(x, <span class="dt">prob =</span> <span class="ot">TRUE</span>, <span class="dt">main =</span> <span class="kw">expression</span>(<span class="kw">f</span>(x)<span class="op">==</span><span class="dv">8</span><span class="op">/</span>x<span class="op">^</span><span class="dv">3</span>))<span class="co">#直方图显示</span></span>
<span id="cb2-5"><a href="#cb2-5"></a>y &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">50</span>, <span class="fl">0.01</span>)<span class="co">#密度函数曲线显示</span></span>
<span id="cb2-6"><a href="#cb2-6"></a><span class="kw">lines</span>(y, <span class="dv">8</span><span class="op">/</span>(y<span class="op">^</span><span class="dv">3</span>))</span></code></pre></div>
<p><span class="math inline">\(3.9 \quad\)</span></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>n &lt;-<span class="st"> </span><span class="dv">1000</span> <span class="co"># 随机数个数  先通过beta随机数拟合，将结果与另一种定义方式的结果进行比较</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>y &lt;-<span class="st"> </span><span class="kw">rbeta</span>(n,<span class="dv">2</span>,<span class="dv">2</span>) <span class="co">#另Y=(X+1)/2，Y~Be(2,2),由Y产生随机数</span></span>
<span id="cb3-3"><a href="#cb3-3"></a>x &lt;-<span class="st"> </span><span class="dv">2</span><span class="op">*</span>y<span class="dv">-1</span> <span class="co">#将Y产生的随机数结果回代</span></span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="kw">hist</span>(x, <span class="dt">prob =</span> <span class="ot">TRUE</span>, <span class="dt">main =</span> <span class="kw">expression</span>(<span class="kw">f</span>(x)<span class="op">==</span>(<span class="dv">3</span><span class="op">/</span><span class="dv">4</span>)(<span class="dv">1</span><span class="op">-</span>x<span class="op">^</span><span class="dv">2</span>))) <span class="co">#由此得到直方图</span></span>
<span id="cb3-5"><a href="#cb3-5"></a>z &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="fl">0.01</span>) <span class="co">#将结果进行拟合</span></span>
<span id="cb3-6"><a href="#cb3-6"></a><span class="kw">lines</span>(z, (<span class="dv">3</span><span class="op">/</span><span class="dv">4</span>)<span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>z<span class="op">^</span><span class="dv">2</span>))</span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>nu &lt;-<span class="st"> </span><span class="dv">1000</span>  <span class="co">#通过题目给出的公式定义得到相同的结果图像并进行拟合</span></span>
<span id="cb4-2"><a href="#cb4-2"></a>i &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>nu) {</span>
<span id="cb4-4"><a href="#cb4-4"></a>  u1 &lt;-<span class="st"> </span><span class="kw">runif</span>(nu,<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>)</span>
<span id="cb4-5"><a href="#cb4-5"></a>  u2 &lt;-<span class="st"> </span><span class="kw">runif</span>(nu,<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>)</span>
<span id="cb4-6"><a href="#cb4-6"></a>  u3 &lt;-<span class="st"> </span><span class="kw">runif</span>(nu,<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>)</span>
<span id="cb4-7"><a href="#cb4-7"></a>  <span class="cf">if</span>(<span class="kw">abs</span>(u3[i]) <span class="op">&gt;=</span><span class="st"> </span><span class="kw">abs</span>(u2[i]) <span class="op">&amp;&amp;</span><span class="st"> </span><span class="kw">abs</span>(u3[i]) <span class="op">&gt;=</span><span class="st"> </span><span class="kw">abs</span>(u1[i])){</span>
<span id="cb4-8"><a href="#cb4-8"></a>    u[i] &lt;-<span class="st"> </span>u2[i]}</span>
<span id="cb4-9"><a href="#cb4-9"></a>  <span class="cf">else</span></span>
<span id="cb4-10"><a href="#cb4-10"></a>   { u[i] &lt;-<span class="st"> </span>u3[i]}</span>
<span id="cb4-11"><a href="#cb4-11"></a>}</span>
<span id="cb4-12"><a href="#cb4-12"></a><span class="kw">hist</span>(u, <span class="dt">prob =</span> <span class="ot">TRUE</span>, <span class="dt">main =</span> <span class="kw">expression</span>(<span class="kw">f</span>(x)<span class="op">==</span>(<span class="dv">3</span><span class="op">/</span><span class="dv">4</span>)(<span class="dv">1</span><span class="op">-</span>x<span class="op">^</span><span class="dv">2</span>)))</span>
<span id="cb4-13"><a href="#cb4-13"></a>z &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="fl">0.01</span>)</span>
<span id="cb4-14"><a href="#cb4-14"></a><span class="kw">lines</span>(z, (<span class="dv">3</span><span class="op">/</span><span class="dv">4</span>)<span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>z<span class="op">^</span><span class="dv">2</span>))</span></code></pre></div>
<p><span class="math inline">\(3.10 \quad\)</span> <span class="math display">\[
因为函数为分段函数，可以分别计算各段结果再代入:\\
当-1\le u\le 0时，F(U\le u )=F_{1}+F_{2}\\
其中F_{1}=\int_{-1}^{u} \int_{-\left|u_{3}\right|}^{u} \int_{-\left|u_{3}\right|}^{\left|u_{3}\right|} f\left(u_{1}\right) f\left(u_{2}\right) f\left(u_{3}\right) d u_{1} d u_{2} d u_{3} +\int_{u}^{1} \int_{-\left|u_{3}\right|}^{u} \int_{-\left|u_{3}\right|}^{\left|u_{3}\right|} f\left(u_{1}\right) f\left(u_{2}\right) f\left(u_{3}\right) d u_{1} d u_{2} d u_{3}\\
=-\frac{u^{3}}{12}+\frac{u}{4}+\frac{1}{6}\\
F_2=2[\int_{-1}^{u} \int_{-1}^{u_3} f\left(u_{1}\right) f\left(u_{3}\right) d u_{1}  d u_{3}+\int_{-1}^{u} \int_{|u_3|}^{1} f\left(u_{1}\right) f\left(u_{3}\right) d u_{1}  d u_{3}]\\
-\int_{-1}^{u} \int_{-1}^{u_3} \int_{-1}^{u_3} f\left(u_{1}\right) f\left(u_{2}\right) f\left(u_{3}\right) d u_{1} d u_{2} d u_{3}-\int_{-1}^{u} \int_{-1}^{u_3} \int_{|u_3|}^{1} f\left(u_{1}\right) f\left(u_{2}\right) f\left(u_{3}\right) d u_{1} d u_{2} d u_{3}\\
-\int_{-1}^{u} \int_{|u_3|}^{1} \int_{-1}^{u_3} f\left(u_{1}\right) f\left(u_{2}\right) f\left(u_{3}\right) d u_{1} d u_{2} d u_{3}-\int_{-1}^{u} \int_{|u_3|}^{1} \int_{|u_3|}^{1} f\left(u_{1}\right) f\left(u_{2}\right) f\left(u_{3}\right) d u_{1} d u_{2} d u_{3}\\
=-\frac{u^{3}}{6}+\frac{u}{2}+\frac{1}{3}\\
所以，当0\le u\le 1时，F(U\le u )=F_{1}+F_{2}=-\frac{u^{3}}{12}+\frac{u}{4}+\frac{1}{6}-\frac{u^{3}}{6}+\frac{u}{2}+\frac{1}{3}\\
=-\frac{u^{3}}{4}+\frac{3 u}{4}+\frac{1}{2}\\
同理，将0 \le u\le 1的情况也做上述分割，分别计算，最终得到的结果为\\
F=F_1+F_2=-\frac{u^{3}}{12}+\frac{u}{4}+\frac{1}{6}-\frac{u^{3}}{6}+\frac{u}{2}+\frac{1}{3}\\
=-\frac{u^{3}}{4}+\frac{3 u}{4}+\frac{1}{2}\\
所以F(u)=F_{e}(x),原命题得证
\]</span></p>
<p><span class="math inline">\(3.13 \quad\)</span></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>n &lt;-<span class="st"> </span><span class="dv">1000</span></span>
<span id="cb5-2"><a href="#cb5-2"></a>u &lt;-<span class="st"> </span><span class="kw">runif</span>(n)</span>
<span id="cb5-3"><a href="#cb5-3"></a>x &lt;-<span class="st"> </span>(<span class="dv">2</span><span class="op">/</span>(<span class="dv">1</span><span class="op">-</span>u)<span class="op">^</span>(<span class="dv">1</span><span class="op">/</span><span class="dv">4</span>))<span class="op">-</span><span class="dv">2</span> <span class="co">#U=1-(2/(2+X))^4，X=(2/(1-U)^(1/4))-2</span></span>
<span id="cb5-4"><a href="#cb5-4"></a><span class="kw">hist</span>(x, <span class="dt">prob =</span> <span class="ot">TRUE</span>, <span class="dt">main =</span> <span class="kw">expression</span>(<span class="kw">f</span>(x)<span class="op">==</span><span class="dv">64</span><span class="op">/</span>(x<span class="op">+</span><span class="dv">2</span>)<span class="op">^</span><span class="dv">5</span>)) <span class="co"># 求导得密度函数</span></span>
<span id="cb5-5"><a href="#cb5-5"></a>y &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">20</span>, <span class="fl">0.01</span>) <span class="co"># 得到密度函数曲线</span></span>
<span id="cb5-6"><a href="#cb5-6"></a><span class="kw">lines</span>(y, <span class="dv">64</span><span class="op">/</span>(y<span class="op">+</span><span class="dv">2</span>)<span class="op">^</span><span class="dv">5</span>)</span></code></pre></div>
</div>
<div id="section-2" class="section level2">
<h2>2020/10/13</h2>
</div>
<div id="question-2" class="section level2">
<h2>Question</h2>
<p><span class="math inline">\(\begin{array}{ll}\text { Exercises 5.1, 5.7, and 5.11 (pages 149-151, Statistical Computating with R).}\end{array}\)</span></p>
<p><span class="math inline">\(5.1 \quad\)</span> Compute a Monte Carlo estimate of <span class="math display">\[
\int_{0}^{\pi / 3} \sin t d t
\]</span> and compare your estimate with the exact value of the integral.</p>
<p><span class="math inline">\(5.7 \quad\)</span> Refer to Exercise 5.6 . Use a Monte Carlo simulation to estimate $ $ by the antithetic variate approach and by the simple Monte Carlo method. Compute an empirical estimate of the percent reduction variance in using the antithetic variate. Compare the result with the theoretical value from Exercise 5.6 .</p>
<p><span class="math inline">\(5.11 \quad\)</span> If <span class="math inline">\(\hat{\theta}_{1}\)</span> and <span class="math inline">\(\hat{\theta}_{2}\)</span> are unbiased estimators of <span class="math inline">\(\theta,\)</span> and <span class="math inline">\(\hat{\theta}_{1}\)</span> and <span class="math inline">\(\hat{\theta}_{2}\)</span> are antithetic, we derived that <span class="math inline">\(c^{*}=1 / 2\)</span> is the optimal constant that minimizes the variance of <span class="math inline">\(\hat{\theta}_{c}=c \hat{\theta}_{2}+(1-c) \hat{\theta}_{2} .\)</span> Derive <span class="math inline">\(c^{*}\)</span> for the general case. That is, if <span class="math inline">\(\hat{\theta}_{1}\)</span> and <span class="math inline">\(\hat{\theta}_{2}\)</span> are any two unbiased estimators of <span class="math inline">\(\theta,\)</span> find the value <span class="math inline">\(c^{*}\)</span> that minimizes the variance of the estimator <span class="math inline">\(\hat{\theta}_{c}=c \hat{\theta}_{1}+(1-c) \hat{\theta}_{2}\)</span> in equation <span class="math inline">\((5.11) .\left(c^{*}\right.\)</span> will be a function of the variances and the covariance of the estimators.)</p>
</div>
<div id="answer-2" class="section level2">
<h2>Answer</h2>
<p><span class="math inline">\(5.1 \quad\)</span></p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>m &lt;-<span class="st"> </span><span class="fl">1e4</span></span>
<span id="cb6-2"><a href="#cb6-2"></a>x &lt;-<span class="st"> </span><span class="kw">runif</span>(m, <span class="dt">min=</span><span class="dv">0</span>, <span class="dt">max=</span>pi<span class="op">/</span><span class="dv">3</span>)<span class="co">#设置10000个随机数，产生10000个从0到(pi/3)的均匀分布随机数</span></span>
<span id="cb6-3"><a href="#cb6-3"></a>pihat &lt;-<span class="st"> </span><span class="kw">mean</span>(<span class="kw">sin</span>(x))<span class="op">*</span>(pi<span class="op">/</span><span class="dv">3</span>)<span class="co">#(pi/3)E(sin(X))</span></span>
<span id="cb6-4"><a href="#cb6-4"></a><span class="kw">print</span>(<span class="kw">c</span>(pihat,<span class="op">-</span><span class="kw">cos</span>(pi<span class="op">/</span><span class="dv">3</span>) <span class="op">+</span><span class="st"> </span><span class="kw">cos</span>(<span class="dv">0</span>)))<span class="co">#分别显示估计和真实的积分值</span></span></code></pre></div>
<p><span class="math inline">\(5.7 \quad\)</span></p>
<p>因为两种方法上用的随机数都为m，所以可以先将方差扩大m倍进行计算</p>
<p><span class="math inline">\(Var(e^U+e^{1-U})=Var(e^U)+Var(e^{1-U})+2Cov(e^U,e^{1-U})\)</span></p>
<p><span class="math inline">\(=\frac {e^2-1}{2}-(e-1)^2+\frac {e^2-1}{2}-(e-1)^2+2(3e-e^2-1)\)</span></p>
<p><span class="math inline">\(\approx 0.2420+0.2420-0.4684\)</span></p>
<p><span class="math inline">\(=0.0156\)</span></p>
<p>简单的蒙特卡洛模型的方差为:</p>
<p><span class="math inline">\(Var(g(U))=Var(e^U)\approx0.2420\)</span></p>
<p>所以方差减少的百分比为<span class="math inline">\(1-0.0156/0.2420\approx93.6\%\)</span></p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="co">#先使用the simple Monte Carlo method</span></span>
<span id="cb7-2"><a href="#cb7-2"></a>m &lt;-<span class="st"> </span><span class="fl">1e4</span></span>
<span id="cb7-3"><a href="#cb7-3"></a>x &lt;-<span class="st"> </span><span class="kw">runif</span>(m, <span class="dt">min=</span><span class="dv">0</span>, <span class="dt">max=</span><span class="dv">1</span>)</span>
<span id="cb7-4"><a href="#cb7-4"></a>theta.hat &lt;-<span class="st"> </span><span class="kw">mean</span>(<span class="kw">exp</span>(x))</span>
<span id="cb7-5"><a href="#cb7-5"></a><span class="co">#再使用antithetic variate approach</span></span>
<span id="cb7-6"><a href="#cb7-6"></a>m_&lt;-<span class="st"> </span><span class="fl">1e4</span><span class="op">/</span><span class="dv">2</span></span>
<span id="cb7-7"><a href="#cb7-7"></a>x1 &lt;-<span class="st"> </span><span class="kw">runif</span>(m_, <span class="dt">min=</span><span class="dv">0</span>, <span class="dt">max=</span><span class="dv">1</span>)</span>
<span id="cb7-8"><a href="#cb7-8"></a>x2 &lt;-<span class="st"> </span><span class="kw">runif</span>(m_, <span class="dt">min=</span><span class="dv">0</span>, <span class="dt">max=</span><span class="dv">1</span>)</span>
<span id="cb7-9"><a href="#cb7-9"></a>theta_.hat &lt;-<span class="st"> </span>(<span class="kw">mean</span>(<span class="kw">exp</span>(x1))<span class="op">+</span><span class="kw">mean</span>(<span class="kw">exp</span>(<span class="dv">1</span><span class="op">-</span>x2)))<span class="op">/</span><span class="dv">2</span></span>
<span id="cb7-10"><a href="#cb7-10"></a><span class="kw">print</span>(<span class="kw">c</span>(theta.hat,theta_.hat,<span class="kw">exp</span>(<span class="dv">1</span>)<span class="op">-</span><span class="dv">1</span>))</span></code></pre></div>
<p><span class="math inline">\(5.11 \quad\)</span> <span class="math inline">\(\hat{\theta}_{1}\)</span> 和 <span class="math inline">\(\hat{\theta}_{2}\)</span> 是对立的，所以<span class="math inline">\(Var(\hat{\theta}_1)\)</span>=<span class="math inline">\(Var(\hat{\theta}_2)\)</span>,<span class="math inline">\(Corr(\hat{\theta}_1,\hat{\theta}_2)=-1\)</span>,所以<span class="math inline">\(Cov(\hat{\theta}_1,\hat{\theta}_2)=-Var(\hat{\theta}_2)\)</span></p>
<p><span class="math inline">\(\hat{\theta}_{c}=c \hat{\theta}_{1}+(1-c)\hat{\theta}_{2}\)</span></p>
<p><span class="math inline">\(Var(\hat{\theta}_c)=c^2Var(\hat{\theta}_1)+(1-c^2)Var(\hat{\theta}_2)+2c(1-c)Cov(\hat{\theta}_1,\hat{\theta}_2)\)</span></p>
<p><span class="math inline">\(=4c^2Var(\hat{\theta}_2)-4cVar(\hat{\theta}_2)+Var(\hat{\theta}_2)\)</span></p>
<p><span class="math inline">\(=(4c^2-4c+1)Var(\hat{\theta}_2)\)</span></p>
<p>所以，当<span class="math inline">\(c=\frac {1}{2}\)</span>时，方差最小，原命题得证</p>
</div>
<div id="section-3" class="section level2">
<h2>2020/10/20</h2>
</div>
<div id="question-3" class="section level2">
<h2>Question</h2>
<p>Exercises 5.13, 5.15, 6.4, and 6.5 (page 151 and 180,Statistical Computating with R).</p>
<p><span class="math inline">\(5.13 \quad\)</span> Find two importance functions <span class="math inline">\(f_{1}\)</span> and <span class="math inline">\(f_{2}\)</span> that are supported on <span class="math inline">\((1, \infty)\)</span> and are ‘close’ to <span class="math display">\[
g(x)=\frac{x^{2}}{\sqrt{2 \pi}} e^{-x^{2} / 2}, \quad x&gt;1
\]</span> Which of your two importance functions should produce the smaller variance in estimating <span class="math display">\[
\int_{1}^{\infty} \frac{x^{2}}{\sqrt{2 \pi}} e^{-x^{2} / 2} d x
\]</span> by importance sampling? Explain.</p>
<p><span class="math inline">\(5.15 \quad\)</span> Obtain the stratifified importance sampling estimate in Example <span class="math inline">\(5.13.\)</span> and compare it with the result of Example 5.10.</p>
<p><span class="math inline">\(6.4 \quad\)</span> Suppose that <span class="math inline">\(X_{1}, \ldots, X_{n}\)</span> are a random sample from a from a lognormal distribution with unknown parameters. Construct a <span class="math inline">\(95 \%\)</span> confidence interval for the parameter <span class="math inline">\(\mu .\)</span> Use a Monte Carlo method to obtain an empirical estimate of the confidence level.</p>
<p><span class="math inline">\(6.5 \quad\)</span> Suppose a <span class="math inline">\(95 \%\)</span> symmetric <span class="math inline">\(t\)</span> -interval is applied to estimate a mean, but the sample data are non-normal. Then the probability that the confidence interval covers the mean is not necessarily equal to <span class="math inline">\(0.95 .\)</span> Use a Monte Carlo experiment to estimate the coverage probability of the <span class="math inline">\(t\)</span> -interval for random samples of <span class="math inline">\(\chi^{2}(2)\)</span> data with sample size <span class="math inline">\(n=20 .\)</span> Compare your <span class="math inline">\(t\)</span> -interval results with the simulation results in Example <span class="math inline">\(6.4 .\)</span> (The <span class="math inline">\(t\)</span> -interval should be more robust to departures from normality than the interval for variance.)</p>
</div>
<div id="answer-3" class="section level2">
<h2>Answer</h2>
<p><span class="math inline">\(5.13 \quad\)</span></p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>m &lt;-<span class="st"> </span><span class="fl">1e4</span></span>
<span id="cb8-2"><a href="#cb8-2"></a>f1 &lt;-<span class="st"> </span><span class="cf">function</span>(u)u<span class="op">^</span>(<span class="dv">1</span><span class="op">/</span><span class="dv">4</span>)<span class="co">#g(x)/f_1(x)=1/x^4,g(x)/f_2(x)=exp(-(1/2*x^2))，将其换</span></span>
<span id="cb8-3"><a href="#cb8-3"></a>f2 &lt;-<span class="st"> </span><span class="cf">function</span>(u)<span class="kw">exp</span>(<span class="op">-</span>(<span class="dv">1</span><span class="op">/</span><span class="dv">2</span><span class="op">*</span>u<span class="op">^</span><span class="dv">2</span>))<span class="co"># 成（0，1）区间的值更便于计算</span></span>
<span id="cb8-4"><a href="#cb8-4"></a><span class="kw">set.seed</span>(<span class="dv">510</span>);  u &lt;-<span class="st"> </span><span class="kw">runif</span>(m)</span>
<span id="cb8-5"><a href="#cb8-5"></a>T1 &lt;-<span class="st"> </span><span class="kw">f1</span>(u); T2 &lt;-<span class="st"> </span><span class="kw">f2</span>(u)</span>
<span id="cb8-6"><a href="#cb8-6"></a><span class="kw">c</span>(<span class="kw">mean</span>(T1), <span class="kw">mean</span>(T2))  </span>
<span id="cb8-7"><a href="#cb8-7"></a><span class="kw">c</span>(<span class="kw">sd</span>(T1)<span class="op">/</span><span class="kw">sqrt</span>(m), <span class="kw">sd</span>(T2)<span class="op">/</span><span class="kw">sqrt</span>(m))<span class="co">#由结果可知，第二种估计的方差较小，但是不一定是良好的估计，因为你可选择的范围比较多，所以要对结果进行检验</span></span></code></pre></div>
<p><span class="math inline">\(5.15 \quad\)</span></p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>M &lt;-<span class="st"> </span><span class="dv">10000</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>k &lt;-<span class="st"> </span><span class="dv">5</span> <span class="co">#分成五个区间</span></span>
<span id="cb9-3"><a href="#cb9-3"></a><span class="co">#由上面的估计结果和接下来的估计结果可以知道，虽然上面的方法可适用的范围比较广，但是也很容易存在较大的偏差。相较起来，本方法的准确性更高，且具有更小的方差，所以本估计方法是一种优良的估计方法</span></span>
<span id="cb9-4"><a href="#cb9-4"></a>r &lt;-<span class="st"> </span>M<span class="op">/</span>k </span>
<span id="cb9-5"><a href="#cb9-5"></a>N &lt;-<span class="st"> </span><span class="dv">50</span> </span>
<span id="cb9-6"><a href="#cb9-6"></a>T2 &lt;-<span class="st"> </span><span class="kw">numeric</span>(k)</span>
<span id="cb9-7"><a href="#cb9-7"></a>est &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">0</span>, N, <span class="dv">2</span>)</span>
<span id="cb9-8"><a href="#cb9-8"></a>g&lt;-<span class="cf">function</span>(t)(<span class="dv">1</span><span class="op">-</span><span class="kw">exp</span>(<span class="op">-</span><span class="dv">1</span>))<span class="op">/</span>(<span class="dv">1</span><span class="op">+</span>t<span class="op">^</span><span class="dv">2</span>)<span class="op">*</span>(t<span class="op">&gt;</span><span class="dv">0</span>)<span class="op">*</span>(t<span class="op">&lt;</span><span class="dv">1</span>)<span class="co">#g(x)/f(x)=(1-exp(-1))/(1+x^2)</span></span>
<span id="cb9-9"><a href="#cb9-9"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>N) {</span>
<span id="cb9-10"><a href="#cb9-10"></a>  est[i, <span class="dv">1</span>] &lt;-<span class="st"> </span><span class="kw">mean</span>(<span class="kw">g</span>(<span class="kw">runif</span>(M)))</span>
<span id="cb9-11"><a href="#cb9-11"></a>  <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>k)T2[j]&lt;-<span class="kw">mean</span>(<span class="kw">g</span>(<span class="kw">runif</span>(M<span class="op">/</span>k,(j<span class="dv">-1</span>)<span class="op">/</span>k,j<span class="op">/</span>k)))</span>
<span id="cb9-12"><a href="#cb9-12"></a>  est[i, <span class="dv">2</span>] &lt;-<span class="st"> </span><span class="kw">mean</span>(T2)</span>
<span id="cb9-13"><a href="#cb9-13"></a>}</span>
<span id="cb9-14"><a href="#cb9-14"></a><span class="kw">apply</span>(est,<span class="dv">2</span>,mean)<span class="co">#分层重要抽样法的适用范围更广</span></span>
<span id="cb9-15"><a href="#cb9-15"></a><span class="kw">apply</span>(est,<span class="dv">2</span>,sd)<span class="co">#相对于例5.10的结果来说，分层重要抽样法得到的结果更加精确，并且标准差更小</span></span></code></pre></div>
<p><span class="math inline">\(6.4\quad\)</span></p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>n &lt;-<span class="st"> </span><span class="dv">20</span><span class="co">#X服从对数正态分布，Y=ln(x)~N(μ,σ^2)，所以可以直接利用Y进行估计，再代入x即可</span></span>
<span id="cb10-2"><a href="#cb10-2"></a>alpha &lt;-<span class="st"> </span><span class="fl">.05</span><span class="co">#置信度95%的置信区间求得的结果为(mean(y)-sqrt(var(y))* qt(1-alpha/2,df = n-1) / sqrt(n),mean(y)+sqrt(var(y))* qt(1-alpha/2,df = n-1) / sqrt(n))</span></span>
<span id="cb10-3"><a href="#cb10-3"></a>m &lt;-<span class="st"> </span><span class="dv">1000</span></span>
<span id="cb10-4"><a href="#cb10-4"></a>mu &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb10-5"><a href="#cb10-5"></a>s&lt;-<span class="dv">0</span></span>
<span id="cb10-6"><a href="#cb10-6"></a>UCL &lt;-<span class="st"> </span>USL &lt;-<span class="st"> </span><span class="kw">numeric</span>(m)</span>
<span id="cb10-7"><a href="#cb10-7"></a>est &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">0</span>, m, <span class="dv">2</span>)</span>
<span id="cb10-8"><a href="#cb10-8"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>m) {</span>
<span id="cb10-9"><a href="#cb10-9"></a>  y &lt;-<span class="st"> </span><span class="kw">rnorm</span>(n,<span class="dt">mean =</span> mu,<span class="dt">sd =</span><span class="dv">2</span>)<span class="co">#y是正态分布随机量</span></span>
<span id="cb10-10"><a href="#cb10-10"></a>  est[i, <span class="dv">1</span>] &lt;-<span class="st"> </span><span class="kw">mean</span>(y)</span>
<span id="cb10-11"><a href="#cb10-11"></a>  est[i, <span class="dv">2</span>] &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">var</span>(y))<span class="op">*</span><span class="st"> </span><span class="kw">qt</span>(<span class="dv">1</span><span class="op">-</span>alpha<span class="op">/</span><span class="dv">2</span>,<span class="dt">df =</span> n<span class="dv">-1</span>) <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(n)</span>
<span id="cb10-12"><a href="#cb10-12"></a>  UCL[i] &lt;-<span class="st"> </span>est[i, <span class="dv">1</span>] <span class="op">+</span><span class="st"> </span>est[i, <span class="dv">2</span>]</span>
<span id="cb10-13"><a href="#cb10-13"></a>  USL[i] &lt;-<span class="st"> </span>est[i, <span class="dv">1</span>] <span class="op">-</span><span class="st"> </span>est[i, <span class="dv">2</span>]</span>
<span id="cb10-14"><a href="#cb10-14"></a>  s&lt;-s<span class="op">+</span>(USL[i] <span class="op">&lt;</span><span class="st"> </span>mu <span class="op">&amp;&amp;</span><span class="st"> </span>mu <span class="op">&lt;</span><span class="st"> </span>UCL[i] )<span class="co">#统计区间包含真实值的数目</span></span>
<span id="cb10-15"><a href="#cb10-15"></a>}</span>
<span id="cb10-16"><a href="#cb10-16"></a></span>
<span id="cb10-17"><a href="#cb10-17"></a>s<span class="op">/</span>m<span class="co">#统计区间包含真实值的比例</span></span></code></pre></div>
<p><span class="math inline">\(6.5 \quad\)</span></p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>n &lt;-<span class="st"> </span><span class="dv">20</span></span>
<span id="cb11-2"><a href="#cb11-2"></a>alpha &lt;-<span class="st"> </span><span class="fl">.05</span></span>
<span id="cb11-3"><a href="#cb11-3"></a>m &lt;-<span class="st"> </span><span class="dv">1000</span></span>
<span id="cb11-4"><a href="#cb11-4"></a>mu &lt;-<span class="st"> </span><span class="dv">2</span></span>
<span id="cb11-5"><a href="#cb11-5"></a>s &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb11-6"><a href="#cb11-6"></a>UCL &lt;-<span class="st"> </span>USL &lt;-<span class="st"> </span><span class="kw">numeric</span>(m)</span>
<span id="cb11-7"><a href="#cb11-7"></a>est &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">0</span>, m, <span class="dv">2</span>)</span>
<span id="cb11-8"><a href="#cb11-8"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>m) {</span>
<span id="cb11-9"><a href="#cb11-9"></a>  y &lt;-<span class="st"> </span><span class="kw">rchisq</span>(n,<span class="dt">df =</span> <span class="dv">2</span>)<span class="co">#令样本改成卡方分布</span></span>
<span id="cb11-10"><a href="#cb11-10"></a>  est[i, <span class="dv">1</span>] &lt;-<span class="st"> </span><span class="kw">mean</span>(y)</span>
<span id="cb11-11"><a href="#cb11-11"></a>  est[i, <span class="dv">2</span>] &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">var</span>(y))<span class="op">*</span><span class="st"> </span><span class="kw">qt</span>(<span class="dv">1</span><span class="op">-</span>alpha<span class="op">/</span><span class="dv">2</span>,<span class="dt">df =</span> n<span class="dv">-1</span>) <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(n)</span>
<span id="cb11-12"><a href="#cb11-12"></a>  UCL[i] &lt;-<span class="st"> </span>est[i, <span class="dv">1</span>] <span class="op">+</span><span class="st"> </span>est[i, <span class="dv">2</span>]</span>
<span id="cb11-13"><a href="#cb11-13"></a>  USL[i] &lt;-<span class="st"> </span>est[i, <span class="dv">1</span>] <span class="op">-</span><span class="st"> </span>est[i, <span class="dv">2</span>]</span>
<span id="cb11-14"><a href="#cb11-14"></a>  s&lt;-s<span class="op">+</span>(USL[i] <span class="op">&lt;</span><span class="st"> </span>mu <span class="op">&amp;&amp;</span><span class="st"> </span>mu <span class="op">&lt;</span><span class="st"> </span>UCL[i] )<span class="co">#样本抽样方法改变后，得到的数据相对不稳定，置信区间的估计并不良好</span></span>
<span id="cb11-15"><a href="#cb11-15"></a>}</span>
<span id="cb11-16"><a href="#cb11-16"></a>s<span class="op">/</span>m</span></code></pre></div>
</div>
<div id="section-4" class="section level2">
<h2>2020/10/27</h2>
</div>
<div id="question-4" class="section level2">
<h2>Question</h2>
<p>Exercises 6.7, 6.8, and 6.C (pages 180-182, StatisticalComputating with R).</p>
<p>6.7 Estimate the power of the skewness test of normality against symmetric Beta(<em>α, α</em>) distributions and comment on the results. Are the results different for heavy-tailed symmetric alternatives such as <em>t</em>(<em>ν</em>)?</p>
<p>6.8 Refer to Example 6.16. Repeat the simulation, but also compute the <em>F</em> test of equal variance, at significance level <span class="math inline">\(\widehat α\)</span> <span class="math inline">\(\doteq\)</span> 0<em>.</em>055. Compare the power of the Count Five test and <em>F</em> test for small, medium, and large sample sizes. (Recall that the <em>F</em> test is not applicable for non-normal distributions.)</p>
<p>6.C Repeat Examples 6.8 and 6.10 for Mardia’s multivariate skewness test. Mardia [187] proposed tests of multivariate normality based on multivariate generalizations of skewness and kurtosis. If <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> are iid, the multivariate population skewness <span class="math inline">\(\beta_{1, d}\)</span> is defined by Mardia as <span class="math display">\[
\beta_{1, d}=E\left[(X-\mu)^{T} \Sigma^{-1}(Y-\mu)\right]^{3}
\]</span> Under normality, <span class="math inline">\(\beta_{1, d}=0 .\)</span> The multivariate skewness statistic is <span class="math display">\[
b_{1, d}=\frac{1}{n^{2}} \sum_{i, j=1}^{n}\left(\left(X_{i}-\bar{X}\right)^{T} \widehat{\Sigma}^{-1}\left(X_{j}-\bar{X}\right)\right)^{3}
\]</span> where <span class="math inline">\(\hat{\Sigma}\)</span> is the maximum likelihood estimator of covariance. Large values of <span class="math inline">\(b_{1, d}\)</span> are significant. The asymptotic distribution of <span class="math inline">\(n b_{1, d} / 6\)</span> is chisquared with <span class="math inline">\(d(d+1)(d+2) / 6\)</span> degrees of freedom.</p>
<p>Discussion</p>
<p>If we obtain the powers for two methods under a particular simulation setting with 10,000 experiments: say, 0.651 for one method and 0.676 for another method. Can we say the powers are different at 0.05 level?</p>
<p>1、What is the corresponding hypothesis test problem?</p>
<p>2、What test should we use? Z-test, two-sample t-test, paired-t test or McNemar test?</p>
<p>3、What information is needed to test your hypothesis?</p>
</div>
<div id="answer-4" class="section level2">
<h2>Answer</h2>
<p>6.7</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>sk &lt;-<span class="st"> </span><span class="cf">function</span>(x){</span>
<span id="cb12-2"><a href="#cb12-2"></a>  <span class="co">#计算样本偏度系数</span></span>
<span id="cb12-3"><a href="#cb12-3"></a>  xbar &lt;-<span class="st"> </span><span class="kw">mean</span>(x)</span>
<span id="cb12-4"><a href="#cb12-4"></a>  m3 &lt;-<span class="st"> </span><span class="kw">mean</span>((x<span class="op">-</span>xbar)<span class="op">^</span><span class="dv">3</span>)</span>
<span id="cb12-5"><a href="#cb12-5"></a>  m2 &lt;-<span class="st"> </span><span class="kw">mean</span>((x<span class="op">-</span>xbar)<span class="op">^</span><span class="dv">2</span>)</span>
<span id="cb12-6"><a href="#cb12-6"></a>  <span class="kw">return</span>( m3 <span class="op">/</span><span class="st"> </span>m2<span class="op">^</span><span class="fl">1.5</span>)</span>
<span id="cb12-7"><a href="#cb12-7"></a>}</span>
<span id="cb12-8"><a href="#cb12-8"></a></span>
<span id="cb12-9"><a href="#cb12-9"></a>alpha &lt;-<span class="st"> </span><span class="fl">.05</span></span>
<span id="cb12-10"><a href="#cb12-10"></a>n &lt;-<span class="st"> </span><span class="dv">30</span></span>
<span id="cb12-11"><a href="#cb12-11"></a>m &lt;-<span class="st"> </span><span class="dv">2500</span></span>
<span id="cb12-12"><a href="#cb12-12"></a><span class="co">#epsilon &lt;- c(seq(0.01,.15,.01),seq(.15,1,.05))</span></span>
<span id="cb12-13"><a href="#cb12-13"></a>epsilon1 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">seq</span>(<span class="fl">0.01</span>,.<span class="dv">15</span>,.<span class="dv">01</span>),<span class="kw">seq</span>(.<span class="dv">15</span>,<span class="dv">1</span>,.<span class="dv">05</span>),<span class="kw">seq</span>(<span class="dv">1</span>,<span class="dv">20</span>,<span class="dv">1</span>))<span class="co">#epsilon表示α参数</span></span>
<span id="cb12-14"><a href="#cb12-14"></a>N &lt;-<span class="st"> </span><span class="kw">length</span>(epsilon1)</span>
<span id="cb12-15"><a href="#cb12-15"></a>pwr &lt;-<span class="st"> </span><span class="kw">numeric</span>(N)</span>
<span id="cb12-16"><a href="#cb12-16"></a>cv &lt;-<span class="st"> </span><span class="kw">qnorm</span>(<span class="dv">1</span><span class="op">-</span>alpha<span class="op">/</span><span class="dv">2</span>,<span class="dv">0</span>,<span class="kw">sqrt</span>(<span class="dv">6</span><span class="op">*</span>(n<span class="dv">-2</span>)<span class="op">/</span>((n<span class="op">+</span><span class="dv">1</span>)<span class="op">*</span>(n<span class="op">+</span><span class="dv">3</span>))))</span>
<span id="cb12-17"><a href="#cb12-17"></a></span>
<span id="cb12-18"><a href="#cb12-18"></a><span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>N){</span>
<span id="cb12-19"><a href="#cb12-19"></a>  e &lt;-<span class="st"> </span>epsilon1[j]</span>
<span id="cb12-20"><a href="#cb12-20"></a>  sktests &lt;-<span class="st"> </span><span class="kw">numeric</span>(m)</span>
<span id="cb12-21"><a href="#cb12-21"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>m) {</span>
<span id="cb12-22"><a href="#cb12-22"></a>    x &lt;-<span class="st"> </span><span class="kw">rbeta</span>(n,e,e)</span>
<span id="cb12-23"><a href="#cb12-23"></a>    sktests[i] &lt;-<span class="st"> </span><span class="kw">as.integer</span>(<span class="kw">abs</span>(<span class="kw">sk</span>(x)) <span class="op">&gt;=</span><span class="st"> </span>cv)</span>
<span id="cb12-24"><a href="#cb12-24"></a>  }</span>
<span id="cb12-25"><a href="#cb12-25"></a>  pwr[j] &lt;-<span class="st"> </span><span class="kw">mean</span>(sktests)</span>
<span id="cb12-26"><a href="#cb12-26"></a>}</span>
<span id="cb12-27"><a href="#cb12-27"></a></span>
<span id="cb12-28"><a href="#cb12-28"></a></span>
<span id="cb12-29"><a href="#cb12-29"></a><span class="kw">plot</span>(epsilon1,pwr,<span class="dt">type =</span> <span class="st">&quot;b&quot;</span>,<span class="dt">xlab =</span> <span class="kw">bquote</span>(eplison1),<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="fl">0.1</span>))</span>
<span id="cb12-30"><a href="#cb12-30"></a><span class="kw">abline</span>(<span class="dt">h =</span> <span class="fl">.1</span>,<span class="dt">lty =</span> <span class="dv">3</span>)</span>
<span id="cb12-31"><a href="#cb12-31"></a>se &lt;-<span class="st"> </span><span class="kw">sqrt</span>(pwr <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span><span class="op">-</span>pwr) <span class="op">/</span><span class="st"> </span>m)</span>
<span id="cb12-32"><a href="#cb12-32"></a><span class="kw">lines</span>(epsilon1,pwr<span class="op">+</span>se,<span class="dt">lty =</span> <span class="dv">3</span>)</span>
<span id="cb12-33"><a href="#cb12-33"></a><span class="kw">lines</span>(epsilon1,pwr<span class="op">-</span>se,<span class="dt">lty =</span> <span class="dv">3</span>)</span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>sk &lt;-<span class="st"> </span><span class="cf">function</span>(x){</span>
<span id="cb13-2"><a href="#cb13-2"></a>  <span class="co">#计算样本偏度系数</span></span>
<span id="cb13-3"><a href="#cb13-3"></a>  xbar &lt;-<span class="st"> </span><span class="kw">mean</span>(x)</span>
<span id="cb13-4"><a href="#cb13-4"></a>  m3 &lt;-<span class="st"> </span><span class="kw">mean</span>((x<span class="op">-</span>xbar)<span class="op">^</span><span class="dv">3</span>)</span>
<span id="cb13-5"><a href="#cb13-5"></a>  m2 &lt;-<span class="st"> </span><span class="kw">mean</span>((x<span class="op">-</span>xbar)<span class="op">^</span><span class="dv">2</span>)</span>
<span id="cb13-6"><a href="#cb13-6"></a>  <span class="kw">return</span>( m3 <span class="op">/</span><span class="st"> </span>m2<span class="op">^</span><span class="fl">1.5</span>)</span>
<span id="cb13-7"><a href="#cb13-7"></a>}</span>
<span id="cb13-8"><a href="#cb13-8"></a></span>
<span id="cb13-9"><a href="#cb13-9"></a>alpha &lt;-<span class="st"> </span><span class="fl">.05</span><span class="co">#以t(v)为例</span></span>
<span id="cb13-10"><a href="#cb13-10"></a>n &lt;-<span class="st"> </span><span class="dv">30</span></span>
<span id="cb13-11"><a href="#cb13-11"></a>m &lt;-<span class="st"> </span><span class="dv">2500</span></span>
<span id="cb13-12"><a href="#cb13-12"></a>epsilon2 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">seq</span>(<span class="dv">1</span>,<span class="dv">20</span>,<span class="dv">1</span>))</span>
<span id="cb13-13"><a href="#cb13-13"></a>N &lt;-<span class="st"> </span><span class="kw">length</span>(epsilon2)</span>
<span id="cb13-14"><a href="#cb13-14"></a>pwr &lt;-<span class="st"> </span><span class="kw">numeric</span>(N)</span>
<span id="cb13-15"><a href="#cb13-15"></a>cv &lt;-<span class="st"> </span><span class="kw">qnorm</span>(<span class="dv">1</span><span class="op">-</span>alpha<span class="op">/</span><span class="dv">2</span>,<span class="dv">0</span>,<span class="kw">sqrt</span>(<span class="dv">6</span><span class="op">*</span>(n<span class="dv">-2</span>)<span class="op">/</span>((n<span class="op">+</span><span class="dv">1</span>)<span class="op">*</span>(n<span class="op">+</span><span class="dv">3</span>))))</span>
<span id="cb13-16"><a href="#cb13-16"></a></span>
<span id="cb13-17"><a href="#cb13-17"></a><span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>N){</span>
<span id="cb13-18"><a href="#cb13-18"></a>  e &lt;-<span class="st"> </span>epsilon2[j]</span>
<span id="cb13-19"><a href="#cb13-19"></a>  sktests &lt;-<span class="st"> </span><span class="kw">numeric</span>(m)</span>
<span id="cb13-20"><a href="#cb13-20"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>m) {</span>
<span id="cb13-21"><a href="#cb13-21"></a>    x &lt;-<span class="st"> </span><span class="kw">rt</span>(n,e)</span>
<span id="cb13-22"><a href="#cb13-22"></a>    sktests[i] &lt;-<span class="st"> </span><span class="kw">as.integer</span>(<span class="kw">abs</span>(<span class="kw">sk</span>(x)) <span class="op">&gt;=</span><span class="st"> </span>cv)</span>
<span id="cb13-23"><a href="#cb13-23"></a>  }</span>
<span id="cb13-24"><a href="#cb13-24"></a>  pwr[j] &lt;-<span class="st"> </span><span class="kw">mean</span>(sktests)</span>
<span id="cb13-25"><a href="#cb13-25"></a>}</span>
<span id="cb13-26"><a href="#cb13-26"></a></span>
<span id="cb13-27"><a href="#cb13-27"></a><span class="kw">plot</span>(epsilon2,pwr,<span class="dt">type =</span> <span class="st">&quot;b&quot;</span>,<span class="dt">xlab =</span> <span class="kw">bquote</span>(eplison2),<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))</span>
<span id="cb13-28"><a href="#cb13-28"></a><span class="kw">abline</span>(<span class="dt">h =</span> <span class="dv">1</span>,<span class="dt">lty =</span> <span class="dv">3</span>)</span>
<span id="cb13-29"><a href="#cb13-29"></a>se &lt;-<span class="st"> </span><span class="kw">sqrt</span>(pwr <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span><span class="op">-</span>pwr) <span class="op">/</span><span class="st"> </span>m)</span>
<span id="cb13-30"><a href="#cb13-30"></a><span class="kw">lines</span>(epsilon2,pwr<span class="op">+</span>se,<span class="dt">lty =</span> <span class="dv">3</span>)</span>
<span id="cb13-31"><a href="#cb13-31"></a><span class="kw">lines</span>(epsilon2,pwr<span class="op">-</span>se,<span class="dt">lty =</span> <span class="dv">3</span>)</span></code></pre></div>
<p>Therefore, from the results, when the parameter eplison is less than about 10, the power of the skewness normality test of the symmetric beta distribution is lower than t(v). When the parameter eplison is greater than about 10, the power of the skewness normality test of the symmetric beta distribution is higher than t(v)</p>
<p>6.8</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>count5test &lt;-<span class="st"> </span><span class="cf">function</span>(x,y){</span>
<span id="cb14-2"><a href="#cb14-2"></a>  X &lt;-<span class="st"> </span>x <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(x)</span>
<span id="cb14-3"><a href="#cb14-3"></a>  Y &lt;-<span class="st"> </span>y <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(y)</span>
<span id="cb14-4"><a href="#cb14-4"></a>  outx &lt;-<span class="st"> </span><span class="kw">sum</span>(X <span class="op">&gt;</span><span class="st"> </span><span class="kw">max</span>(Y)) <span class="op">+</span><span class="st"> </span><span class="kw">sum</span>(X <span class="op">&lt;</span><span class="st"> </span><span class="kw">min</span>(Y))</span>
<span id="cb14-5"><a href="#cb14-5"></a>  outy &lt;-<span class="st"> </span><span class="kw">sum</span>(Y <span class="op">&gt;</span><span class="st"> </span><span class="kw">max</span>(X)) <span class="op">+</span><span class="st"> </span><span class="kw">sum</span>(Y <span class="op">&lt;</span><span class="st"> </span><span class="kw">min</span>(X))</span>
<span id="cb14-6"><a href="#cb14-6"></a>  <span class="kw">return</span>(<span class="kw">as.integer</span>(<span class="kw">max</span>(<span class="kw">c</span>(outx,outy)) <span class="op">&gt;</span><span class="st"> </span><span class="dv">5</span>))</span>
<span id="cb14-7"><a href="#cb14-7"></a>}</span>
<span id="cb14-8"><a href="#cb14-8"></a>n &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">20</span>,<span class="dv">200</span>,<span class="dv">1000</span>)<span class="co">#分别对应小样本、中样本和大样本</span></span>
<span id="cb14-9"><a href="#cb14-9"></a>mu1 &lt;-<span class="st"> </span>mu2 &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb14-10"><a href="#cb14-10"></a>sigma1 &lt;-<span class="st"> </span><span class="dv">1</span></span>
<span id="cb14-11"><a href="#cb14-11"></a>sigma2 &lt;-<span class="st"> </span><span class="fl">1.5</span></span>
<span id="cb14-12"><a href="#cb14-12"></a>m &lt;-<span class="st"> </span><span class="dv">10000</span></span>
<span id="cb14-13"><a href="#cb14-13"></a>power1 &lt;-<span class="st"> </span>power2 &lt;-<span class="st"> </span><span class="kw">numeric</span>(<span class="kw">length</span>(n))</span>
<span id="cb14-14"><a href="#cb14-14"></a><span class="kw">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb14-15"><a href="#cb14-15"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(n)){</span>
<span id="cb14-16"><a href="#cb14-16"></a>  power1[i] &lt;-<span class="st"> </span><span class="kw">mean</span>(<span class="kw">replicate</span>(m,<span class="dt">expr =</span> {</span>
<span id="cb14-17"><a href="#cb14-17"></a>  x &lt;-<span class="st"> </span><span class="kw">rnorm</span>(n[i],mu1,sigma1)</span>
<span id="cb14-18"><a href="#cb14-18"></a>  y &lt;-<span class="st"> </span><span class="kw">rnorm</span>(n[i],mu2,sigma2)</span>
<span id="cb14-19"><a href="#cb14-19"></a>  x &lt;-<span class="st"> </span>x <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(x)</span>
<span id="cb14-20"><a href="#cb14-20"></a>  y &lt;-<span class="st"> </span>y <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(y)</span>
<span id="cb14-21"><a href="#cb14-21"></a>  <span class="kw">count5test</span>(x,y)</span>
<span id="cb14-22"><a href="#cb14-22"></a>  }))</span>
<span id="cb14-23"><a href="#cb14-23"></a>   pvalues &lt;-<span class="st"> </span><span class="kw">replicate</span>(m,<span class="dt">expr=</span>{</span>
<span id="cb14-24"><a href="#cb14-24"></a>    x &lt;-<span class="st"> </span><span class="kw">rnorm</span>(n[i],mu1,sigma1)</span>
<span id="cb14-25"><a href="#cb14-25"></a>    y &lt;-<span class="st"> </span><span class="kw">rnorm</span>(n[i],mu2,sigma2)</span>
<span id="cb14-26"><a href="#cb14-26"></a>    Ftest &lt;-<span class="st"> </span><span class="kw">var.test</span>(x, y, <span class="dt">ratio =</span> <span class="dv">1</span>,</span>
<span id="cb14-27"><a href="#cb14-27"></a>                      <span class="dt">alternative =</span> <span class="kw">c</span>(<span class="st">&quot;two.sided&quot;</span>, <span class="st">&quot;less&quot;</span>, <span class="st">&quot;greater&quot;</span>),</span>
<span id="cb14-28"><a href="#cb14-28"></a>                      <span class="dt">conf.level =</span> <span class="fl">0.945</span>, ...)</span>
<span id="cb14-29"><a href="#cb14-29"></a>    Ftest<span class="op">$</span>p.value})</span>
<span id="cb14-30"><a href="#cb14-30"></a>    power2[i] &lt;-<span class="st"> </span><span class="kw">mean</span>(pvalues<span class="op">&lt;=</span><span class="fl">0.055</span>)</span>
<span id="cb14-31"><a href="#cb14-31"></a>}</span>
<span id="cb14-32"><a href="#cb14-32"></a></span>
<span id="cb14-33"><a href="#cb14-33"></a>power1</span>
<span id="cb14-34"><a href="#cb14-34"></a>power2</span></code></pre></div>
<p>From the results, the larger the sample size, the higher the power; under the same sample size, the power of the equal variance F test is higher than that of the Count Five test.</p>
<p>6.C</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="kw">library</span>(MASS)<span class="co"># pressure2, echo=FALSE</span></span>
<span id="cb15-2"><a href="#cb15-2"></a>alpha &lt;-<span class="st"> </span><span class="fl">.05</span></span>
<span id="cb15-3"><a href="#cb15-3"></a>n &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">10</span>,<span class="dv">20</span>,<span class="dv">30</span>,<span class="dv">50</span>,<span class="dv">100</span>,<span class="dv">500</span>) </span>
<span id="cb15-4"><a href="#cb15-4"></a>cv &lt;-<span class="st"> </span><span class="kw">qnorm</span>(<span class="dv">1</span><span class="op">-</span>alpha<span class="op">/</span><span class="dv">2</span>,<span class="dv">0</span>,<span class="kw">sqrt</span>(<span class="dv">6</span><span class="op">/</span>n)) </span>
<span id="cb15-5"><a href="#cb15-5"></a></span>
<span id="cb15-6"><a href="#cb15-6"></a></span>
<span id="cb15-7"><a href="#cb15-7"></a>skn &lt;-<span class="st"> </span><span class="cf">function</span>(x) {<span class="co">#多维下的峰度</span></span>
<span id="cb15-8"><a href="#cb15-8"></a>  xbar &lt;-<span class="st"> </span><span class="kw">mean</span>(x)</span>
<span id="cb15-9"><a href="#cb15-9"></a>  n &lt;-<span class="st"> </span><span class="kw">nrow</span>(x)</span>
<span id="cb15-10"><a href="#cb15-10"></a>  skn &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">/</span>n<span class="op">^</span><span class="dv">2</span><span class="op">*</span><span class="kw">sum</span>(((x<span class="op">-</span>xbar)<span class="op">%*%</span><span class="kw">solve</span>(<span class="kw">cov</span>(x))<span class="op">%*%</span><span class="kw">t</span>(x<span class="op">-</span>xbar))<span class="op">^</span><span class="dv">3</span>)</span>
<span id="cb15-11"><a href="#cb15-11"></a>  <span class="kw">return</span>(skn)</span>
<span id="cb15-12"><a href="#cb15-12"></a>}</span>
<span id="cb15-13"><a href="#cb15-13"></a></span>
<span id="cb15-14"><a href="#cb15-14"></a>p.reject &lt;-<span class="st"> </span><span class="kw">numeric</span>(<span class="kw">length</span>(n))</span>
<span id="cb15-15"><a href="#cb15-15"></a>m &lt;-<span class="st"> </span><span class="dv">10000</span></span>
<span id="cb15-16"><a href="#cb15-16"></a>s &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>),<span class="dv">2</span>,<span class="dv">2</span>)</span>
<span id="cb15-17"><a href="#cb15-17"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(n)) {</span>
<span id="cb15-18"><a href="#cb15-18"></a>  sktests &lt;-<span class="st"> </span><span class="kw">numeric</span>(m)  </span>
<span id="cb15-19"><a href="#cb15-19"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>m) {</span>
<span id="cb15-20"><a href="#cb15-20"></a>    x &lt;-<span class="st"> </span><span class="kw">mvrnorm</span>(n[i],<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),s)</span>
<span id="cb15-21"><a href="#cb15-21"></a>    sktests[j] &lt;-<span class="st"> </span><span class="kw">as.integer</span>(<span class="kw">abs</span>(<span class="kw">skn</span>(x)) <span class="op">&gt;=</span><span class="st"> </span>cv[i])</span>
<span id="cb15-22"><a href="#cb15-22"></a>  }</span>
<span id="cb15-23"><a href="#cb15-23"></a>  p.reject[i] &lt;-<span class="st"> </span><span class="kw">mean</span>(sktests)</span>
<span id="cb15-24"><a href="#cb15-24"></a>}</span>
<span id="cb15-25"><a href="#cb15-25"></a>p.reject</span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="kw">library</span>(MASS)</span>
<span id="cb16-2"><a href="#cb16-2"></a>n &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">10</span>,<span class="dv">20</span>,<span class="dv">30</span>,<span class="dv">50</span>,<span class="dv">100</span>,<span class="dv">500</span>) </span>
<span id="cb16-3"><a href="#cb16-3"></a></span>
<span id="cb16-4"><a href="#cb16-4"></a>sk &lt;-<span class="st"> </span><span class="cf">function</span>(x){</span>
<span id="cb16-5"><a href="#cb16-5"></a>  <span class="co">#计算样本偏度系数</span></span>
<span id="cb16-6"><a href="#cb16-6"></a>  xbar &lt;-<span class="st"> </span><span class="kw">mean</span>(x)</span>
<span id="cb16-7"><a href="#cb16-7"></a>  m3 &lt;-<span class="st"> </span><span class="kw">mean</span>((x<span class="op">-</span>xbar)<span class="op">^</span><span class="dv">3</span>)</span>
<span id="cb16-8"><a href="#cb16-8"></a>  m2 &lt;-<span class="st"> </span><span class="kw">mean</span>((x<span class="op">-</span>xbar)<span class="op">^</span><span class="dv">2</span>)</span>
<span id="cb16-9"><a href="#cb16-9"></a>  <span class="kw">return</span>( m3 <span class="op">/</span><span class="st"> </span>m2<span class="op">^</span><span class="fl">1.5</span>)</span>
<span id="cb16-10"><a href="#cb16-10"></a>}</span>
<span id="cb16-11"><a href="#cb16-11"></a></span>
<span id="cb16-12"><a href="#cb16-12"></a></span>
<span id="cb16-13"><a href="#cb16-13"></a>skn &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</span>
<span id="cb16-14"><a href="#cb16-14"></a>  xbar &lt;-<span class="st"> </span><span class="kw">mean</span>(x)</span>
<span id="cb16-15"><a href="#cb16-15"></a>  n &lt;-<span class="st"> </span><span class="kw">nrow</span>(x)</span>
<span id="cb16-16"><a href="#cb16-16"></a>  skn &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">/</span>n<span class="op">^</span><span class="dv">2</span><span class="op">*</span><span class="kw">sum</span>(((x<span class="op">-</span>xbar)<span class="op">%*%</span><span class="kw">solve</span>(<span class="kw">cov</span>(x))<span class="op">%*%</span><span class="kw">t</span>(x<span class="op">-</span>xbar))<span class="op">^</span><span class="dv">3</span>)</span>
<span id="cb16-17"><a href="#cb16-17"></a>  <span class="kw">return</span>(skn)</span>
<span id="cb16-18"><a href="#cb16-18"></a>}</span>
<span id="cb16-19"><a href="#cb16-19"></a></span>
<span id="cb16-20"><a href="#cb16-20"></a>alpha &lt;-<span class="st"> </span><span class="fl">.1</span></span>
<span id="cb16-21"><a href="#cb16-21"></a>n &lt;-<span class="st"> </span><span class="dv">30</span></span>
<span id="cb16-22"><a href="#cb16-22"></a>m &lt;-<span class="st"> </span><span class="dv">2500</span></span>
<span id="cb16-23"><a href="#cb16-23"></a><span class="co">#s &lt;- matrix(c(1,0,0,1),2,2)</span></span>
<span id="cb16-24"><a href="#cb16-24"></a>epsilon &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">seq</span>(<span class="dv">0</span>,.<span class="dv">15</span>,.<span class="dv">01</span>),<span class="kw">seq</span>(.<span class="dv">15</span>,<span class="dv">1</span>,.<span class="dv">05</span>))</span>
<span id="cb16-25"><a href="#cb16-25"></a>N &lt;-<span class="st"> </span><span class="kw">length</span>(epsilon)</span>
<span id="cb16-26"><a href="#cb16-26"></a>pwr &lt;-<span class="st"> </span><span class="kw">numeric</span>(N)</span>
<span id="cb16-27"><a href="#cb16-27"></a>cv &lt;-<span class="st"> </span><span class="kw">qnorm</span>(<span class="dv">1</span><span class="op">-</span>alpha<span class="op">/</span><span class="dv">2</span>,<span class="dv">0</span>,<span class="kw">sqrt</span>(<span class="dv">6</span><span class="op">*</span>(n<span class="dv">-2</span>)<span class="op">/</span>((n<span class="op">+</span><span class="dv">1</span>)<span class="op">*</span>(n<span class="op">+</span><span class="dv">3</span>))))</span>
<span id="cb16-28"><a href="#cb16-28"></a></span>
<span id="cb16-29"><a href="#cb16-29"></a><span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>N){</span>
<span id="cb16-30"><a href="#cb16-30"></a>  e &lt;-<span class="st"> </span>epsilon[j]</span>
<span id="cb16-31"><a href="#cb16-31"></a>  sktests &lt;-<span class="st"> </span><span class="kw">numeric</span>(m)</span>
<span id="cb16-32"><a href="#cb16-32"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>m) {</span>
<span id="cb16-33"><a href="#cb16-33"></a>   sigma &lt;-<span class="st"> </span><span class="kw">sample</span> (<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">10</span>),<span class="dt">replace =</span> <span class="ot">TRUE</span>,<span class="dt">size =</span> n,<span class="dt">prob =</span> <span class="kw">c</span>(<span class="dv">1</span><span class="op">-</span>e,e))</span>
<span id="cb16-34"><a href="#cb16-34"></a>   <span class="co">#s &lt;- matrix(c(1,0,0,1),2,2)</span></span>
<span id="cb16-35"><a href="#cb16-35"></a>   x &lt;-<span class="st"> </span><span class="kw">rnorm</span>(n,<span class="dv">0</span>,sigma)</span>
<span id="cb16-36"><a href="#cb16-36"></a>   sktests[i] &lt;-<span class="st"> </span><span class="kw">as.integer</span>(<span class="kw">abs</span>(<span class="kw">sk</span>(x)) <span class="op">&gt;=</span><span class="st"> </span>cv)</span>
<span id="cb16-37"><a href="#cb16-37"></a>  }</span>
<span id="cb16-38"><a href="#cb16-38"></a>  pwr[j] &lt;-<span class="st"> </span><span class="kw">mean</span>(sktests)</span>
<span id="cb16-39"><a href="#cb16-39"></a>}</span>
<span id="cb16-40"><a href="#cb16-40"></a></span>
<span id="cb16-41"><a href="#cb16-41"></a></span>
<span id="cb16-42"><a href="#cb16-42"></a><span class="kw">plot</span>(epsilon,pwr,<span class="dt">type =</span> <span class="st">&quot;b&quot;</span>,<span class="dt">xlab =</span> <span class="kw">bquote</span>(eplison),<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))</span>
<span id="cb16-43"><a href="#cb16-43"></a><span class="kw">abline</span>(<span class="dt">h =</span> <span class="fl">.1</span>,<span class="dt">lty =</span> <span class="dv">3</span>)</span>
<span id="cb16-44"><a href="#cb16-44"></a>se &lt;-<span class="st"> </span><span class="kw">sqrt</span>(pwr <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span><span class="op">-</span>pwr) <span class="op">/</span><span class="st"> </span>m)</span>
<span id="cb16-45"><a href="#cb16-45"></a><span class="kw">lines</span>(epsilon,pwr<span class="op">+</span>se,<span class="dt">lty =</span> <span class="dv">3</span>)</span>
<span id="cb16-46"><a href="#cb16-46"></a><span class="kw">lines</span>(epsilon,pwr<span class="op">-</span>se,<span class="dt">lty =</span> <span class="dv">3</span>)</span></code></pre></div>
<p>Discussion</p>
<p>We can’t directly say that the power is different at the 0.05 level</p>
<p>1.Corresponding hypothesis testing problem: the power of the two methods is the same at the 0.05 level</p>
<p>2.The methods that can be used are Z-test, paired-t test and McNemar test,and the method that cannot be used is two-sample t-test.</p>
<p>3.Z test:Let Z[i] =Y[i]-X[i] The paired-t test:Pair the data one by one to get the information The McNemar test :The test needs to process the data in advance. The method A is accepted and the method B is rejected as a, and the method B is accepted and the method A is rejected as b.(a-b)^2/(a+b) approximately obeyed when the null hypothesis holds Chi-square distribution</p>
</div>
<div id="section-5" class="section level2">
<h2>2020/11/03</h2>
</div>
<div id="question-5" class="section level2">
<h2>Question</h2>
<p>Exercises 7.1, 7.5, 7.8, and 7.11 (pages 212-213, Statistical Computating with R)</p>
<p><span class="math inline">\(7.1 \quad\)</span> Compute a jackknife estimate of the bias and the standard error of the correlation statistic in Example 7.2 .</p>
<p><span class="math inline">\(7.5 \quad\)</span> Refer to Exercise <span class="math inline">\(7.4 .\)</span> Compute <span class="math inline">\(95 \%\)</span> bootstrap confidence intervals for the mean time between failures <span class="math inline">\(1 / \lambda\)</span> by the standard normal, basic, percentile, and BCa methods. Compare the intervals and explain why they may differ.</p>
<p><span class="math inline">\(7.8 \quad\)</span> Refer to Exercise <span class="math inline">\(7.7 .\)</span> Obtain the jackknife estimates of bias and standard error of <span class="math inline">\(\hat{\theta}\)</span>.</p>
<p><span class="math inline">\(7.11 \quad\)</span> In Example 7.18,leave-one-out <span class="math inline">\((n\)</span> -fold <span class="math inline">\()\)</span> cross validation was used to select the best fitting model. Use leave-two-out cross validation to compare the models.</p>
</div>
<div id="answer-5" class="section level2">
<h2>Answer</h2>
<p><span class="math inline">\(7.1 \quad\)</span></p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="kw">library</span>(bootstrap) </span>
<span id="cb17-2"><a href="#cb17-2"></a>b.cor &lt;-<span class="st"> </span><span class="cf">function</span>(x,i) <span class="kw">cor</span>(x[i,<span class="dv">1</span>],x[i,<span class="dv">2</span>])</span>
<span id="cb17-3"><a href="#cb17-3"></a>cor.hat &lt;-<span class="st"> </span><span class="kw">cor</span>(law<span class="op">$</span>LSAT, law<span class="op">$</span>GPA)</span>
<span id="cb17-4"><a href="#cb17-4"></a>n &lt;-<span class="st"> </span><span class="kw">nrow</span>(law) </span>
<span id="cb17-5"><a href="#cb17-5"></a>bias.jack &lt;-<span class="st"> </span>se.jack &lt;-<span class="st"> </span>cor.jack &lt;-<span class="st"> </span><span class="kw">numeric</span>(n) </span>
<span id="cb17-6"><a href="#cb17-6"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>n) {</span>
<span id="cb17-7"><a href="#cb17-7"></a>  cor.jack[i] &lt;-<span class="st"> </span><span class="kw">cor</span>(law[(<span class="dv">1</span><span class="op">:</span>n)[<span class="op">-</span>i],<span class="dv">1</span>],law[(<span class="dv">1</span><span class="op">:</span>n)[<span class="op">-</span>i],<span class="dv">2</span>])</span>
<span id="cb17-8"><a href="#cb17-8"></a>}</span>
<span id="cb17-9"><a href="#cb17-9"></a>bias.jack &lt;-<span class="st"> </span>(n<span class="dv">-1</span>)<span class="op">*</span>(<span class="kw">mean</span>(cor.jack)<span class="op">-</span>cor.hat)</span>
<span id="cb17-10"><a href="#cb17-10"></a>se.jack &lt;-<span class="st"> </span><span class="kw">sqrt</span>((n<span class="dv">-1</span>)<span class="op">*</span><span class="kw">mean</span>((cor.jack<span class="op">-</span>cor.hat)<span class="op">^</span><span class="dv">2</span>))</span>
<span id="cb17-11"><a href="#cb17-11"></a><span class="kw">round</span>(<span class="kw">c</span>(<span class="dt">original=</span>cor.hat,<span class="dt">bias.jack=</span>bias.jack, <span class="dt">se.jack=</span>se.jack),<span class="dv">3</span>)</span></code></pre></div>
<p><span class="math inline">\(7.5 \quad\)</span></p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="kw">library</span>(boot)</span>
<span id="cb18-2"><a href="#cb18-2"></a>x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">5</span>,<span class="dv">7</span>,<span class="dv">18</span>,<span class="dv">43</span>,<span class="dv">85</span>,<span class="dv">91</span>,<span class="dv">98</span>,<span class="dv">100</span>,<span class="dv">130</span>,<span class="dv">230</span>,<span class="dv">487</span>)</span>
<span id="cb18-3"><a href="#cb18-3"></a>lambdafe&lt;-<span class="kw">mean</span>(x)</span>
<span id="cb18-4"><a href="#cb18-4"></a>boot.mean &lt;-<span class="st"> </span><span class="cf">function</span>(x,i) <span class="kw">mean</span>(x[i]) </span>
<span id="cb18-5"><a href="#cb18-5"></a> <span class="co"># sz &lt;- rexp(n,lambda)</span></span>
<span id="cb18-6"><a href="#cb18-6"></a>  de &lt;-<span class="st"> </span><span class="kw">boot</span>(<span class="dt">data=</span>x,<span class="dt">statistic=</span>boot.mean, <span class="dt">R =</span> <span class="dv">999</span>) </span>
<span id="cb18-7"><a href="#cb18-7"></a>  ci &lt;-<span class="st"> </span><span class="kw">boot.ci</span>(de,<span class="dt">type=</span><span class="kw">c</span>(<span class="st">&quot;norm&quot;</span>,<span class="st">&quot;basic&quot;</span>,<span class="st">&quot;perc&quot;</span>,<span class="st">&quot;bca&quot;</span>)) </span>
<span id="cb18-8"><a href="#cb18-8"></a>  <span class="kw">boot.ci</span> (de)<span class="co">#</span></span></code></pre></div>
<p>The Bca method produces a relatively large interval,First，the method used is different, and the results are different ,The bootstrap t confidence interval is second order accurate but not transformation respecting. The bootstrap percentile interval is transformation respecting but only first order accurate. The standard normal confidence interval is neither transformation respecting nor second order accurate.</p>
<p><span class="math inline">\(7.8 \quad\)</span></p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="kw">library</span>(bootstrap) </span>
<span id="cb19-2"><a href="#cb19-2"></a>x &lt;-<span class="st"> </span><span class="kw">cov</span>(scor,scor)</span>
<span id="cb19-3"><a href="#cb19-3"></a>b.cor &lt;-<span class="st"> </span><span class="cf">function</span>(x,i) <span class="kw">cor</span>(x[i,<span class="dv">1</span>],x[i,<span class="dv">2</span>])</span>
<span id="cb19-4"><a href="#cb19-4"></a>lamba &lt;-<span class="st"> </span><span class="kw">eigen</span>(x)<span class="op">$</span>values</span>
<span id="cb19-5"><a href="#cb19-5"></a>sumlam &lt;-<span class="st"> </span><span class="kw">sum</span>(lamba)</span>
<span id="cb19-6"><a href="#cb19-6"></a>theta &lt;-<span class="st"> </span>lamba[<span class="dv">1</span>] <span class="op">/</span><span class="st"> </span>sumlam</span>
<span id="cb19-7"><a href="#cb19-7"></a>y &lt;-<span class="st"> </span><span class="kw">numeric</span>(<span class="kw">length</span>(lamba))</span>
<span id="cb19-8"><a href="#cb19-8"></a>B &lt;-<span class="st"> </span><span class="fl">1e4</span></span>
<span id="cb19-9"><a href="#cb19-9"></a>thetastar &lt;-<span class="st"> </span><span class="kw">numeric</span>(B) </span>
<span id="cb19-10"><a href="#cb19-10"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(lamba)){</span>
<span id="cb19-11"><a href="#cb19-11"></a>  y[i] &lt;-<span class="st"> </span>lamba[i] <span class="op">/</span><span class="st"> </span>sumlam</span>
<span id="cb19-12"><a href="#cb19-12"></a>}</span>
<span id="cb19-13"><a href="#cb19-13"></a></span>
<span id="cb19-14"><a href="#cb19-14"></a><span class="cf">for</span>(b <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>B){</span>
<span id="cb19-15"><a href="#cb19-15"></a>  xstar &lt;-<span class="st"> </span><span class="kw">sample</span>(y,<span class="dt">replace=</span><span class="ot">TRUE</span>) </span>
<span id="cb19-16"><a href="#cb19-16"></a>  thetastar[b] &lt;-<span class="st"> </span><span class="kw">mean</span>(xstar)</span>
<span id="cb19-17"><a href="#cb19-17"></a>  } </span>
<span id="cb19-18"><a href="#cb19-18"></a><span class="kw">round</span>(<span class="kw">c</span>(<span class="dt">Bias.boot=</span><span class="kw">mean</span>(thetastar)<span class="op">-</span>theta, <span class="dt">SE.boot=</span><span class="kw">sd</span>(thetastar)),<span class="dv">3</span>) </span></code></pre></div>
<p><span class="math inline">\(7.11 \quad\)</span></p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a><span class="kw">library</span>(DAAG)</span>
<span id="cb20-2"><a href="#cb20-2"></a><span class="kw">attach</span>(ironslag)</span>
<span id="cb20-3"><a href="#cb20-3"></a>n &lt;-<span class="st"> </span><span class="kw">length</span>(magnetic)</span>
<span id="cb20-4"><a href="#cb20-4"></a>e1 &lt;-<span class="st"> </span>e2 &lt;-<span class="st"> </span>e3 &lt;-<span class="st"> </span>e4 &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">0</span>,n,n)</span>
<span id="cb20-5"><a href="#cb20-5"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>n) {</span>
<span id="cb20-6"><a href="#cb20-6"></a>  </span>
<span id="cb20-7"><a href="#cb20-7"></a>  <span class="cf">for</span> (j <span class="cf">in</span> (i<span class="op">+</span><span class="dv">1</span>)<span class="op">:</span>n<span class="dv">-1</span>){</span>
<span id="cb20-8"><a href="#cb20-8"></a>    y &lt;-<span class="st"> </span>magnetic[<span class="op">-</span><span class="kw">c</span>(i,j)]</span>
<span id="cb20-9"><a href="#cb20-9"></a>    x &lt;-<span class="st"> </span>chemical[<span class="op">-</span><span class="kw">c</span>(i,j)]</span>
<span id="cb20-10"><a href="#cb20-10"></a>    </span>
<span id="cb20-11"><a href="#cb20-11"></a>    J1 &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x)</span>
<span id="cb20-12"><a href="#cb20-12"></a>    yhat1 &lt;-<span class="st"> </span>J1<span class="op">$</span>coef[<span class="dv">1</span>] <span class="op">+</span><span class="st"> </span>J1<span class="op">$</span>coef[<span class="dv">2</span>] <span class="op">*</span><span class="st"> </span>chemical[<span class="kw">c</span>(i,j)]</span>
<span id="cb20-13"><a href="#cb20-13"></a>    e1[i,j] &lt;-<span class="st"> </span><span class="kw">mean</span>((magnetic[<span class="kw">c</span>(i,j)] <span class="op">-</span><span class="st"> </span>yhat1)<span class="op">^</span><span class="dv">2</span>)</span>
<span id="cb20-14"><a href="#cb20-14"></a>    </span>
<span id="cb20-15"><a href="#cb20-15"></a>    J2 &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(x<span class="op">^</span><span class="dv">2</span>))</span>
<span id="cb20-16"><a href="#cb20-16"></a>    yhat2 &lt;-<span class="st"> </span>J2<span class="op">$</span>coef[<span class="dv">1</span>] <span class="op">+</span><span class="st"> </span>J2<span class="op">$</span>coef[<span class="dv">2</span>] <span class="op">*</span><span class="st"> </span>chemical[<span class="kw">c</span>(i,j)] <span class="op">+</span><span class="st"> </span>J2<span class="op">$</span>coef[<span class="dv">3</span>] <span class="op">*</span></span>
<span id="cb20-17"><a href="#cb20-17"></a><span class="st">      </span>chemical[<span class="kw">c</span>(i,j)]<span class="op">^</span><span class="dv">2</span></span>
<span id="cb20-18"><a href="#cb20-18"></a>    e2[i,j] &lt;-<span class="st"> </span><span class="kw">mean</span>((magnetic[<span class="kw">c</span>(i,j)] <span class="op">-</span><span class="st"> </span>yhat2)<span class="op">^</span><span class="dv">2</span>)</span>
<span id="cb20-19"><a href="#cb20-19"></a>    </span>
<span id="cb20-20"><a href="#cb20-20"></a>    J3 &lt;-<span class="st"> </span><span class="kw">lm</span>(<span class="kw">log</span>(y) <span class="op">~</span><span class="st"> </span>x)</span>
<span id="cb20-21"><a href="#cb20-21"></a>    logyhat3 &lt;-<span class="st"> </span>J3<span class="op">$</span>coef[<span class="dv">1</span>] <span class="op">+</span><span class="st"> </span>J3<span class="op">$</span>coef[<span class="dv">2</span>] <span class="op">*</span><span class="st"> </span>chemical[<span class="kw">c</span>(i,j)]</span>
<span id="cb20-22"><a href="#cb20-22"></a>    yhat3 &lt;-<span class="st"> </span><span class="kw">exp</span>(logyhat3)</span>
<span id="cb20-23"><a href="#cb20-23"></a>    e3[i,j] &lt;-<span class="kw">mean</span>(( magnetic[<span class="kw">c</span>(i,j)] <span class="op">-</span><span class="st"> </span>yhat3)<span class="op">^</span><span class="dv">2</span>)</span>
<span id="cb20-24"><a href="#cb20-24"></a>    </span>
<span id="cb20-25"><a href="#cb20-25"></a>    J4 &lt;-<span class="st"> </span><span class="kw">lm</span>(<span class="kw">log</span>(y) <span class="op">~</span><span class="st"> </span><span class="kw">log</span>(x))</span>
<span id="cb20-26"><a href="#cb20-26"></a>    logyhat4 &lt;-<span class="st"> </span>J4<span class="op">$</span>coef[<span class="dv">1</span>] <span class="op">+</span><span class="st"> </span>J4<span class="op">$</span>coef[<span class="dv">2</span>] <span class="op">*</span><span class="st"> </span><span class="kw">log</span>(chemical[<span class="kw">c</span>(i,j)])</span>
<span id="cb20-27"><a href="#cb20-27"></a>    yhat4 &lt;-<span class="st"> </span><span class="kw">exp</span>(logyhat4)</span>
<span id="cb20-28"><a href="#cb20-28"></a>    e4[i,j] &lt;-<span class="st"> </span><span class="kw">mean</span>((magnetic[<span class="kw">c</span>(i,j)] <span class="op">-</span><span class="st"> </span>yhat4)<span class="op">^</span><span class="dv">2</span>)</span>
<span id="cb20-29"><a href="#cb20-29"></a>    </span>
<span id="cb20-30"><a href="#cb20-30"></a>  }</span>
<span id="cb20-31"><a href="#cb20-31"></a>  </span>
<span id="cb20-32"><a href="#cb20-32"></a>}</span>
<span id="cb20-33"><a href="#cb20-33"></a><span class="kw">c</span>(<span class="dv">2</span><span class="op">*</span><span class="kw">sum</span>(e1)<span class="op">/</span>(n<span class="op">*</span>(n<span class="dv">-1</span>)),<span class="dv">2</span><span class="op">*</span><span class="kw">sum</span>(e2)<span class="op">/</span>(n<span class="op">*</span>(n<span class="dv">-1</span>)),<span class="dv">2</span><span class="op">*</span><span class="kw">sum</span>(e3)<span class="op">/</span>(n<span class="op">*</span>(n<span class="dv">-1</span>)),<span class="dv">2</span><span class="op">*</span><span class="kw">sum</span>(e4)<span class="op">/</span>(n<span class="op">*</span>(n<span class="dv">-1</span>)))</span></code></pre></div>
<p>In contrast, the J2 model produces the least variance, the best fit effect, the J4 model produces the largest variance, the worst fitting effect</p>
</div>
<div id="section-6" class="section level2">
<h2>2020/11/10</h2>
</div>
<div id="question-6" class="section level2">
<h2>Question</h2>
<p>1.Exercise 8.3 (page 243, Statistical Computating with R).</p>
<p>2.Design experiments for evaluating the performance of the NN, energy, and ball methods in various situations. (1) Unequal variances and equal expectations (2) Unequal variances and unequal expectations (3) Non-normal distributions: t distribution with 1 df (heavy-tailed distribution), bimodel distribution (mixture of two normal distributions) (4) Unbalanced samples (say, 1 case versus 10 controls) (5) Note: The parameters should be chosen such that the powers are distinguishable (say, range from 0.3 to 0.8).</p>
<p>8.3 The Count 5 test for equal variances in Section 6.4 is based on the maximum number of extreme points. Example 6.15 shows that the Count 5 criterion is not applicable for unequal sample sizes. Implement a permutation test for equal variance based on the maximum number of extreme points that applies when sample sizes are not necessarily equal.</p>
</div>
<div id="answer-6" class="section level2">
<h2>Answer</h2>
<p>1</p>
<p>Based on the principle of the maximum number of extreme points, the maximum number can be calculated with the sample size as a weight in case the sample size is different,At the same time, the permutation method is used for testing</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a><span class="kw">set.seed</span>(<span class="dv">111</span>)<span class="co">#</span></span>
<span id="cb21-2"><a href="#cb21-2"></a>count5test &lt;-<span class="st"> </span><span class="cf">function</span>(x, y) {</span>
<span id="cb21-3"><a href="#cb21-3"></a> </span>
<span id="cb21-4"><a href="#cb21-4"></a>X &lt;-<span class="st"> </span>x <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(x)</span>
<span id="cb21-5"><a href="#cb21-5"></a>Y &lt;-<span class="st"> </span>y <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(y)</span>
<span id="cb21-6"><a href="#cb21-6"></a>weight &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="dv">10</span> <span class="op">*</span><span class="st"> </span>(<span class="kw">length</span>(x)<span class="op">/</span>(<span class="kw">length</span>(x)<span class="op">+</span><span class="kw">length</span>(y))))</span>
<span id="cb21-7"><a href="#cb21-7"></a>outx &lt;-<span class="st"> </span><span class="kw">sum</span>(X <span class="op">&gt;</span><span class="st"> </span><span class="kw">max</span>(Y)) <span class="op">+</span><span class="st"> </span><span class="kw">sum</span>(X <span class="op">&lt;</span><span class="st"> </span><span class="kw">min</span>(Y))</span>
<span id="cb21-8"><a href="#cb21-8"></a>outy &lt;-<span class="st"> </span><span class="kw">sum</span>(Y <span class="op">&gt;</span><span class="st"> </span><span class="kw">max</span>(X)) <span class="op">+</span><span class="st"> </span><span class="kw">sum</span>(Y <span class="op">&lt;</span><span class="st"> </span><span class="kw">min</span>(X))</span>
<span id="cb21-9"><a href="#cb21-9"></a><span class="co"># return 1 (reject) or 0 (do not reject H0)</span></span>
<span id="cb21-10"><a href="#cb21-10"></a><span class="kw">return</span>(<span class="kw">as.integer</span>(<span class="kw">min</span>(<span class="kw">c</span>(outx, outy)) <span class="op">&gt;</span><span class="st"> </span>weight <span class="op">||</span><span class="st"> </span><span class="kw">max</span>(<span class="kw">c</span>(outx, outy)) <span class="op">&gt;</span><span class="st"> </span>(<span class="dv">10</span><span class="op">-</span>weight) ))</span>
<span id="cb21-11"><a href="#cb21-11"></a>}</span>
<span id="cb21-12"><a href="#cb21-12"></a></span>
<span id="cb21-13"><a href="#cb21-13"></a>R &lt;-<span class="st"> </span><span class="dv">10000</span></span>
<span id="cb21-14"><a href="#cb21-14"></a>n1 &lt;-<span class="st"> </span><span class="dv">10</span></span>
<span id="cb21-15"><a href="#cb21-15"></a>n2 &lt;-<span class="st"> </span><span class="dv">20</span></span>
<span id="cb21-16"><a href="#cb21-16"></a>weight &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="dv">10</span> <span class="op">*</span><span class="st"> </span>(n1<span class="op">/</span>(n1<span class="op">+</span>n2)))</span>
<span id="cb21-17"><a href="#cb21-17"></a>mu1 &lt;-<span class="st"> </span>mu2 &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb21-18"><a href="#cb21-18"></a>sigma1 &lt;-<span class="st"> </span>sigma2 &lt;-<span class="st"> </span><span class="dv">1</span></span>
<span id="cb21-19"><a href="#cb21-19"></a>x &lt;-<span class="st"> </span><span class="kw">rnorm</span>(n1, mu1, sigma1)</span>
<span id="cb21-20"><a href="#cb21-20"></a>y &lt;-<span class="st"> </span><span class="kw">rnorm</span>(n2, mu2, sigma2)</span>
<span id="cb21-21"><a href="#cb21-21"></a></span>
<span id="cb21-22"><a href="#cb21-22"></a>z &lt;-<span class="st"> </span><span class="kw">c</span>(x,y)</span>
<span id="cb21-23"><a href="#cb21-23"></a>K &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span>(n1 <span class="op">+</span><span class="st"> </span>n2)</span>
<span id="cb21-24"><a href="#cb21-24"></a>n &lt;-<span class="st"> </span><span class="kw">length</span>(x)</span>
<span id="cb21-25"><a href="#cb21-25"></a>jg &lt;-<span class="st"> </span><span class="kw">numeric</span>(R)</span>
<span id="cb21-26"><a href="#cb21-26"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>R) {</span>
<span id="cb21-27"><a href="#cb21-27"></a>  k &lt;-<span class="st"> </span><span class="kw">sample</span>(K, <span class="dt">size =</span> n, <span class="dt">replace =</span> <span class="ot">FALSE</span>)</span>
<span id="cb21-28"><a href="#cb21-28"></a>  x1 &lt;-<span class="st"> </span>z[k];y1 &lt;-<span class="st"> </span>z[<span class="op">-</span>k]</span>
<span id="cb21-29"><a href="#cb21-29"></a>  x1 &lt;-<span class="st"> </span>x1 <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(x1) <span class="co">#centered by sample mean</span></span>
<span id="cb21-30"><a href="#cb21-30"></a>  y1 &lt;-<span class="st"> </span>y1 <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(y1)</span>
<span id="cb21-31"><a href="#cb21-31"></a> jg[i] &lt;-<span class="st"> </span><span class="kw">count5test</span>(x1, y1)</span>
<span id="cb21-32"><a href="#cb21-32"></a>}</span>
<span id="cb21-33"><a href="#cb21-33"></a></span>
<span id="cb21-34"><a href="#cb21-34"></a>q &lt;-<span class="st"> </span><span class="kw">mean</span>(jg)</span>
<span id="cb21-35"><a href="#cb21-35"></a><span class="kw">round</span>(<span class="kw">c</span>(q),<span class="dv">3</span>)</span></code></pre></div>
<p>2</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a><span class="kw">set.seed</span>(<span class="dv">12</span>)</span>
<span id="cb22-2"><a href="#cb22-2"></a><span class="kw">library</span>(RANN)<span class="co">#Unequal variances and equal expectations</span></span>
<span id="cb22-3"><a href="#cb22-3"></a><span class="kw">library</span>(boot)</span>
<span id="cb22-4"><a href="#cb22-4"></a><span class="kw">library</span>(energy)</span>
<span id="cb22-5"><a href="#cb22-5"></a><span class="kw">library</span>(Ball)</span>
<span id="cb22-6"><a href="#cb22-6"></a></span>
<span id="cb22-7"><a href="#cb22-7"></a>Tn &lt;-<span class="st"> </span><span class="cf">function</span>(z, ix, sizes,k) {</span>
<span id="cb22-8"><a href="#cb22-8"></a>  n1 &lt;-<span class="st"> </span>sizes[<span class="dv">1</span>]; n2 &lt;-<span class="st"> </span>sizes[<span class="dv">2</span>]; n &lt;-<span class="st"> </span>n1 <span class="op">+</span><span class="st"> </span>n2</span>
<span id="cb22-9"><a href="#cb22-9"></a>  <span class="cf">if</span>(<span class="kw">is.vector</span>(z)) z &lt;-<span class="st"> </span><span class="kw">data.frame</span>(z,<span class="dv">0</span>);</span>
<span id="cb22-10"><a href="#cb22-10"></a>  z &lt;-<span class="st"> </span>z[ix, ];</span>
<span id="cb22-11"><a href="#cb22-11"></a>  NN &lt;-<span class="st"> </span><span class="kw">nn2</span>(<span class="dt">data=</span>z, <span class="dt">k=</span>k<span class="op">+</span><span class="dv">1</span>) <span class="co"># what&#39;s the first column?</span></span>
<span id="cb22-12"><a href="#cb22-12"></a>  block1 &lt;-<span class="st"> </span>NN<span class="op">$</span>nn.idx[<span class="dv">1</span><span class="op">:</span>n1,<span class="op">-</span><span class="dv">1</span>] </span>
<span id="cb22-13"><a href="#cb22-13"></a>  block2 &lt;-<span class="st"> </span>NN<span class="op">$</span>nn.idx[(n1<span class="op">+</span><span class="dv">1</span>)<span class="op">:</span>n,<span class="op">-</span><span class="dv">1</span>] </span>
<span id="cb22-14"><a href="#cb22-14"></a>  i1 &lt;-<span class="st"> </span><span class="kw">sum</span>(block1 <span class="op">&lt;</span><span class="st"> </span>n1 <span class="op">+</span><span class="st"> </span><span class="fl">.5</span>); i2 &lt;-<span class="st"> </span><span class="kw">sum</span>(block2 <span class="op">&gt;</span><span class="st"> </span>n1<span class="fl">+.5</span>) </span>
<span id="cb22-15"><a href="#cb22-15"></a>  (i1 <span class="op">+</span><span class="st"> </span>i2) <span class="op">/</span><span class="st"> </span>(k <span class="op">*</span><span class="st"> </span>n)</span>
<span id="cb22-16"><a href="#cb22-16"></a>}</span>
<span id="cb22-17"><a href="#cb22-17"></a></span>
<span id="cb22-18"><a href="#cb22-18"></a>m &lt;-<span class="st"> </span><span class="fl">1e2</span>; k&lt;-<span class="dv">3</span>; p&lt;-<span class="dv">2</span>; mu &lt;-<span class="st"> </span><span class="fl">0.3</span></span>
<span id="cb22-19"><a href="#cb22-19"></a>n1 &lt;-<span class="st"> </span>n2 &lt;-<span class="st"> </span><span class="dv">50</span>; R&lt;-<span class="dv">999</span>; n &lt;-<span class="st"> </span>n1<span class="op">+</span>n2; N =<span class="st"> </span><span class="kw">c</span>(n1,n2)</span>
<span id="cb22-20"><a href="#cb22-20"></a></span>
<span id="cb22-21"><a href="#cb22-21"></a>eqdist.nn &lt;-<span class="st"> </span><span class="cf">function</span>(z,sizes,k){</span>
<span id="cb22-22"><a href="#cb22-22"></a>  boot.obj &lt;-<span class="st"> </span><span class="kw">boot</span>(<span class="dt">data=</span>z,<span class="dt">statistic=</span>Tn,<span class="dt">R=</span><span class="dv">999</span>,</span>
<span id="cb22-23"><a href="#cb22-23"></a>  <span class="dt">sim =</span> <span class="st">&quot;permutation&quot;</span>, <span class="dt">sizes =</span> N,<span class="dt">k=</span>k)</span>
<span id="cb22-24"><a href="#cb22-24"></a>  ts &lt;-<span class="st"> </span><span class="kw">c</span>(boot.obj<span class="op">$</span>t0,boot.obj<span class="op">$</span>t)</span>
<span id="cb22-25"><a href="#cb22-25"></a>  p.value &lt;-<span class="st"> </span><span class="kw">mean</span>(ts<span class="op">&gt;=</span>ts[<span class="dv">1</span>])</span>
<span id="cb22-26"><a href="#cb22-26"></a>  <span class="kw">list</span>(<span class="dt">statistic=</span>ts[<span class="dv">1</span>],<span class="dt">p.value=</span>p.value)</span>
<span id="cb22-27"><a href="#cb22-27"></a>}</span>
<span id="cb22-28"><a href="#cb22-28"></a></span>
<span id="cb22-29"><a href="#cb22-29"></a>p.values &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA</span>,m,<span class="dv">3</span>)</span>
<span id="cb22-30"><a href="#cb22-30"></a></span>
<span id="cb22-31"><a href="#cb22-31"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>m){</span>
<span id="cb22-32"><a href="#cb22-32"></a>  x &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rnorm</span>(n1<span class="op">*</span>p,<span class="dv">0</span>,<span class="dv">1</span>),<span class="dt">ncol=</span>p);</span>
<span id="cb22-33"><a href="#cb22-33"></a>  y &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="kw">rnorm</span>(n2,<span class="dv">0</span>,<span class="fl">1.2</span>),<span class="kw">rnorm</span>(n2,<span class="dv">0</span>,<span class="fl">1.2</span>));</span>
<span id="cb22-34"><a href="#cb22-34"></a>  z &lt;-<span class="st"> </span><span class="kw">rbind</span>(x,y)</span>
<span id="cb22-35"><a href="#cb22-35"></a>  p.values[i,<span class="dv">1</span>] &lt;-<span class="st"> </span><span class="kw">eqdist.nn</span>(z,N,k)<span class="op">$</span>p.value</span>
<span id="cb22-36"><a href="#cb22-36"></a>  p.values[i,<span class="dv">2</span>] &lt;-<span class="st"> </span><span class="kw">eqdist.etest</span>(z,<span class="dt">sizes=</span>N,<span class="dt">R=</span><span class="dv">999</span>)<span class="op">$</span>p.value</span>
<span id="cb22-37"><a href="#cb22-37"></a>  p.values[i,<span class="dv">3</span>] &lt;-<span class="kw">bd.test</span>(<span class="dt">x=</span>x,<span class="dt">y=</span>y,<span class="dt">num.permutations=</span><span class="dv">999</span>,<span class="dt">seed=</span>i<span class="op">*</span><span class="dv">12345</span>)<span class="op">$</span>p.value</span>
<span id="cb22-38"><a href="#cb22-38"></a>}</span>
<span id="cb22-39"><a href="#cb22-39"></a>p.value1 &lt;-<span class="st"> </span><span class="kw">mean</span>(p.values[i,<span class="dv">1</span>])</span>
<span id="cb22-40"><a href="#cb22-40"></a>p.value2 &lt;-<span class="st"> </span><span class="kw">mean</span>(p.values[i,<span class="dv">2</span>])</span>
<span id="cb22-41"><a href="#cb22-41"></a>p.value3 &lt;-<span class="st"> </span><span class="kw">mean</span>(p.values[i,<span class="dv">3</span>])</span>
<span id="cb22-42"><a href="#cb22-42"></a><span class="kw">round</span>(<span class="kw">c</span>(p.value1,p.value2,p.value3),<span class="dv">3</span>)<span class="co">#nearest NN test and Ball test are generally less powerful than Energy test</span></span></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a><span class="kw">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb23-2"><a href="#cb23-2"></a><span class="kw">library</span>(RANN)<span class="co">#Unequal variances and unequal expectations</span></span>
<span id="cb23-3"><a href="#cb23-3"></a><span class="kw">library</span>(boot)</span>
<span id="cb23-4"><a href="#cb23-4"></a><span class="kw">library</span>(energy)</span>
<span id="cb23-5"><a href="#cb23-5"></a><span class="kw">library</span>(Ball)</span>
<span id="cb23-6"><a href="#cb23-6"></a></span>
<span id="cb23-7"><a href="#cb23-7"></a>Tn &lt;-<span class="st"> </span><span class="cf">function</span>(z, ix, sizes,k) {</span>
<span id="cb23-8"><a href="#cb23-8"></a>  n1 &lt;-<span class="st"> </span>sizes[<span class="dv">1</span>]; n2 &lt;-<span class="st"> </span>sizes[<span class="dv">2</span>]; n &lt;-<span class="st"> </span>n1 <span class="op">+</span><span class="st"> </span>n2</span>
<span id="cb23-9"><a href="#cb23-9"></a>  <span class="cf">if</span>(<span class="kw">is.vector</span>(z)) z &lt;-<span class="st"> </span><span class="kw">data.frame</span>(z,<span class="dv">0</span>);</span>
<span id="cb23-10"><a href="#cb23-10"></a>  z &lt;-<span class="st"> </span>z[ix, ];</span>
<span id="cb23-11"><a href="#cb23-11"></a>  NN &lt;-<span class="st"> </span><span class="kw">nn2</span>(<span class="dt">data=</span>z, <span class="dt">k=</span>k<span class="op">+</span><span class="dv">1</span>) <span class="co"># what&#39;s the first column?</span></span>
<span id="cb23-12"><a href="#cb23-12"></a>  block1 &lt;-<span class="st"> </span>NN<span class="op">$</span>nn.idx[<span class="dv">1</span><span class="op">:</span>n1,<span class="op">-</span><span class="dv">1</span>] </span>
<span id="cb23-13"><a href="#cb23-13"></a>  block2 &lt;-<span class="st"> </span>NN<span class="op">$</span>nn.idx[(n1<span class="op">+</span><span class="dv">1</span>)<span class="op">:</span>n,<span class="op">-</span><span class="dv">1</span>] </span>
<span id="cb23-14"><a href="#cb23-14"></a>  i1 &lt;-<span class="st"> </span><span class="kw">sum</span>(block1 <span class="op">&lt;</span><span class="st"> </span>n1 <span class="op">+</span><span class="st"> </span><span class="fl">.5</span>); i2 &lt;-<span class="st"> </span><span class="kw">sum</span>(block2 <span class="op">&gt;</span><span class="st"> </span>n1<span class="fl">+.5</span>) </span>
<span id="cb23-15"><a href="#cb23-15"></a>  (i1 <span class="op">+</span><span class="st"> </span>i2) <span class="op">/</span><span class="st"> </span>(k <span class="op">*</span><span class="st"> </span>n)</span>
<span id="cb23-16"><a href="#cb23-16"></a>}</span>
<span id="cb23-17"><a href="#cb23-17"></a></span>
<span id="cb23-18"><a href="#cb23-18"></a>m &lt;-<span class="st"> </span><span class="fl">1e2</span>; k&lt;-<span class="dv">3</span>; p&lt;-<span class="dv">2</span>; mu &lt;-<span class="st"> </span><span class="fl">0.3</span></span>
<span id="cb23-19"><a href="#cb23-19"></a>n1 &lt;-<span class="st"> </span>n2 &lt;-<span class="st"> </span><span class="dv">50</span>; R&lt;-<span class="dv">999</span>; n &lt;-<span class="st"> </span>n1<span class="op">+</span>n2; N =<span class="st"> </span><span class="kw">c</span>(n1,n2)</span>
<span id="cb23-20"><a href="#cb23-20"></a></span>
<span id="cb23-21"><a href="#cb23-21"></a>eqdist.nn &lt;-<span class="st"> </span><span class="cf">function</span>(z,sizes,k){</span>
<span id="cb23-22"><a href="#cb23-22"></a>  boot.obj &lt;-<span class="st"> </span><span class="kw">boot</span>(<span class="dt">data=</span>z,<span class="dt">statistic=</span>Tn,<span class="dt">R=</span><span class="dv">999</span>,</span>
<span id="cb23-23"><a href="#cb23-23"></a>  <span class="dt">sim =</span> <span class="st">&quot;permutation&quot;</span>, <span class="dt">sizes =</span> N,<span class="dt">k=</span>k)</span>
<span id="cb23-24"><a href="#cb23-24"></a>  ts &lt;-<span class="st"> </span><span class="kw">c</span>(boot.obj<span class="op">$</span>t0,boot.obj<span class="op">$</span>t)</span>
<span id="cb23-25"><a href="#cb23-25"></a>  p.value &lt;-<span class="st"> </span><span class="kw">mean</span>(ts<span class="op">&gt;=</span>ts[<span class="dv">1</span>])</span>
<span id="cb23-26"><a href="#cb23-26"></a>  <span class="kw">list</span>(<span class="dt">statistic=</span>ts[<span class="dv">1</span>],<span class="dt">p.value=</span>p.value)</span>
<span id="cb23-27"><a href="#cb23-27"></a>}</span>
<span id="cb23-28"><a href="#cb23-28"></a></span>
<span id="cb23-29"><a href="#cb23-29"></a>p.values &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA</span>,m,<span class="dv">3</span>)</span>
<span id="cb23-30"><a href="#cb23-30"></a></span>
<span id="cb23-31"><a href="#cb23-31"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>m){</span>
<span id="cb23-32"><a href="#cb23-32"></a>  x &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rnorm</span>(n1<span class="op">*</span>p,<span class="dv">0</span>,<span class="dv">1</span>),<span class="dt">ncol=</span>p);</span>
<span id="cb23-33"><a href="#cb23-33"></a>  y &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="kw">rnorm</span>(n2,<span class="fl">0.1</span>,<span class="fl">1.2</span>),<span class="kw">rnorm</span>(n2,<span class="fl">0.1</span>,<span class="fl">1.2</span>));</span>
<span id="cb23-34"><a href="#cb23-34"></a>  z &lt;-<span class="st"> </span><span class="kw">rbind</span>(x,y)</span>
<span id="cb23-35"><a href="#cb23-35"></a>  p.values[i,<span class="dv">1</span>] &lt;-<span class="st"> </span><span class="kw">eqdist.nn</span>(z,N,k)<span class="op">$</span>p.value</span>
<span id="cb23-36"><a href="#cb23-36"></a>  p.values[i,<span class="dv">2</span>] &lt;-<span class="st"> </span><span class="kw">eqdist.etest</span>(z,<span class="dt">sizes=</span>N,<span class="dt">R=</span><span class="dv">999</span>)<span class="op">$</span>p.value</span>
<span id="cb23-37"><a href="#cb23-37"></a>  p.values[i,<span class="dv">3</span>] &lt;-<span class="kw">bd.test</span>(<span class="dt">x=</span>x,<span class="dt">y=</span>y,<span class="dt">num.permutations=</span><span class="dv">999</span>,<span class="dt">seed=</span>i<span class="op">*</span><span class="dv">12345</span>)<span class="op">$</span>p.value</span>
<span id="cb23-38"><a href="#cb23-38"></a>}</span>
<span id="cb23-39"><a href="#cb23-39"></a>p.value1 &lt;-<span class="st"> </span><span class="kw">mean</span>(p.values[i,<span class="dv">1</span>])</span>
<span id="cb23-40"><a href="#cb23-40"></a>p.value2 &lt;-<span class="st"> </span><span class="kw">mean</span>(p.values[i,<span class="dv">2</span>])</span>
<span id="cb23-41"><a href="#cb23-41"></a>p.value3 &lt;-<span class="st"> </span><span class="kw">mean</span>(p.values[i,<span class="dv">3</span>])</span>
<span id="cb23-42"><a href="#cb23-42"></a><span class="kw">round</span>(<span class="kw">c</span>(p.value1,p.value2,p.value3),<span class="dv">3</span>)<span class="co">#Nearest NN test and Ball test are generally less powerful than Energy test </span></span></code></pre></div>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a><span class="kw">set.seed</span>(<span class="dv">125</span>)</span>
<span id="cb24-2"><a href="#cb24-2"></a><span class="kw">library</span>(RANN)<span class="co">#Non-normal distributions: t distribution with 1 df (heavy-tailed distribution),</span></span>
<span id="cb24-3"><a href="#cb24-3"></a><span class="kw">library</span>(boot)</span>
<span id="cb24-4"><a href="#cb24-4"></a><span class="kw">library</span>(energy)</span>
<span id="cb24-5"><a href="#cb24-5"></a><span class="kw">library</span>(Ball)</span>
<span id="cb24-6"><a href="#cb24-6"></a></span>
<span id="cb24-7"><a href="#cb24-7"></a>Tn &lt;-<span class="st"> </span><span class="cf">function</span>(z, ix, sizes,k) {</span>
<span id="cb24-8"><a href="#cb24-8"></a>  n1 &lt;-<span class="st"> </span>sizes[<span class="dv">1</span>]; n2 &lt;-<span class="st"> </span>sizes[<span class="dv">2</span>]; n &lt;-<span class="st"> </span>n1 <span class="op">+</span><span class="st"> </span>n2</span>
<span id="cb24-9"><a href="#cb24-9"></a>  <span class="cf">if</span>(<span class="kw">is.vector</span>(z)) z &lt;-<span class="st"> </span><span class="kw">data.frame</span>(z,<span class="dv">0</span>);</span>
<span id="cb24-10"><a href="#cb24-10"></a>  z &lt;-<span class="st"> </span>z[ix, ];</span>
<span id="cb24-11"><a href="#cb24-11"></a>  NN &lt;-<span class="st"> </span><span class="kw">nn2</span>(<span class="dt">data=</span>z, <span class="dt">k=</span>k<span class="op">+</span><span class="dv">1</span>) <span class="co"># what&#39;s the first column?</span></span>
<span id="cb24-12"><a href="#cb24-12"></a>  block1 &lt;-<span class="st"> </span>NN<span class="op">$</span>nn.idx[<span class="dv">1</span><span class="op">:</span>n1,<span class="op">-</span><span class="dv">1</span>] </span>
<span id="cb24-13"><a href="#cb24-13"></a>  block2 &lt;-<span class="st"> </span>NN<span class="op">$</span>nn.idx[(n1<span class="op">+</span><span class="dv">1</span>)<span class="op">:</span>n,<span class="op">-</span><span class="dv">1</span>] </span>
<span id="cb24-14"><a href="#cb24-14"></a>  i1 &lt;-<span class="st"> </span><span class="kw">sum</span>(block1 <span class="op">&lt;</span><span class="st"> </span>n1 <span class="op">+</span><span class="st"> </span><span class="fl">.5</span>); i2 &lt;-<span class="st"> </span><span class="kw">sum</span>(block2 <span class="op">&gt;</span><span class="st"> </span>n1<span class="fl">+.5</span>) </span>
<span id="cb24-15"><a href="#cb24-15"></a>  (i1 <span class="op">+</span><span class="st"> </span>i2) <span class="op">/</span><span class="st"> </span>(k <span class="op">*</span><span class="st"> </span>n)</span>
<span id="cb24-16"><a href="#cb24-16"></a>}</span>
<span id="cb24-17"><a href="#cb24-17"></a></span>
<span id="cb24-18"><a href="#cb24-18"></a>m &lt;-<span class="st"> </span><span class="fl">1e2</span>; k&lt;-<span class="dv">3</span>; p&lt;-<span class="dv">2</span>; mu &lt;-<span class="st"> </span><span class="fl">0.3</span></span>
<span id="cb24-19"><a href="#cb24-19"></a>n1 &lt;-<span class="st"> </span>n2 &lt;-<span class="st"> </span><span class="dv">10</span>; R&lt;-<span class="dv">999</span>; n &lt;-<span class="st"> </span>n1<span class="op">+</span>n2; N =<span class="st"> </span><span class="kw">c</span>(n1,n2)</span>
<span id="cb24-20"><a href="#cb24-20"></a></span>
<span id="cb24-21"><a href="#cb24-21"></a>eqdist.nn &lt;-<span class="st"> </span><span class="cf">function</span>(z,sizes,k){</span>
<span id="cb24-22"><a href="#cb24-22"></a>  boot.obj &lt;-<span class="st"> </span><span class="kw">boot</span>(<span class="dt">data=</span>z,<span class="dt">statistic=</span>Tn,<span class="dt">R=</span><span class="dv">999</span>,</span>
<span id="cb24-23"><a href="#cb24-23"></a>  <span class="dt">sim =</span> <span class="st">&quot;permutation&quot;</span>, <span class="dt">sizes =</span> N,<span class="dt">k=</span>k)</span>
<span id="cb24-24"><a href="#cb24-24"></a>  ts &lt;-<span class="st"> </span><span class="kw">c</span>(boot.obj<span class="op">$</span>t0,boot.obj<span class="op">$</span>t)</span>
<span id="cb24-25"><a href="#cb24-25"></a>  p.value &lt;-<span class="st"> </span><span class="kw">mean</span>(ts<span class="op">&gt;=</span>ts[<span class="dv">1</span>])</span>
<span id="cb24-26"><a href="#cb24-26"></a>  <span class="kw">list</span>(<span class="dt">statistic=</span>ts[<span class="dv">1</span>],<span class="dt">p.value=</span>p.value)</span>
<span id="cb24-27"><a href="#cb24-27"></a>}</span>
<span id="cb24-28"><a href="#cb24-28"></a></span>
<span id="cb24-29"><a href="#cb24-29"></a>p.values &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA</span>,m,<span class="dv">3</span>)</span>
<span id="cb24-30"><a href="#cb24-30"></a></span>
<span id="cb24-31"><a href="#cb24-31"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>m){</span>
<span id="cb24-32"><a href="#cb24-32"></a>  x &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rt</span>(n1<span class="op">*</span>p,n1),<span class="dt">ncol=</span>p);</span>
<span id="cb24-33"><a href="#cb24-33"></a>  y &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="kw">rt</span>(n2,n2),<span class="kw">rt</span>(n2,n2));</span>
<span id="cb24-34"><a href="#cb24-34"></a>  z &lt;-<span class="st"> </span><span class="kw">rbind</span>(x,y)</span>
<span id="cb24-35"><a href="#cb24-35"></a>  p.values[i,<span class="dv">1</span>] &lt;-<span class="st"> </span><span class="kw">eqdist.nn</span>(z,N,k)<span class="op">$</span>p.value</span>
<span id="cb24-36"><a href="#cb24-36"></a>  p.values[i,<span class="dv">2</span>] &lt;-<span class="st"> </span><span class="kw">eqdist.etest</span>(z,<span class="dt">sizes=</span>N,<span class="dt">R=</span><span class="dv">999</span>)<span class="op">$</span>p.value</span>
<span id="cb24-37"><a href="#cb24-37"></a>  p.values[i,<span class="dv">3</span>] &lt;-<span class="kw">bd.test</span>(<span class="dt">x=</span>x,<span class="dt">y=</span>y,<span class="dt">num.permutations=</span><span class="dv">999</span>,<span class="dt">seed=</span>i<span class="op">*</span><span class="dv">12345</span>)<span class="op">$</span>p.value</span>
<span id="cb24-38"><a href="#cb24-38"></a>}</span>
<span id="cb24-39"><a href="#cb24-39"></a>p.value1 &lt;-<span class="st"> </span><span class="kw">mean</span>(p.values[i,<span class="dv">1</span>])</span>
<span id="cb24-40"><a href="#cb24-40"></a>p.value2 &lt;-<span class="st"> </span><span class="kw">mean</span>(p.values[i,<span class="dv">2</span>])</span>
<span id="cb24-41"><a href="#cb24-41"></a>p.value3 &lt;-<span class="st"> </span><span class="kw">mean</span>(p.values[i,<span class="dv">3</span>])</span>
<span id="cb24-42"><a href="#cb24-42"></a><span class="kw">round</span>(<span class="kw">c</span>(p.value1,p.value2,p.value3),<span class="dv">5</span>)<span class="co">#Energy test and nearest NN test are generally less powerful than  Ball test</span></span></code></pre></div>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a><span class="kw">set.seed</span>(<span class="dv">12345</span>)</span>
<span id="cb25-2"><a href="#cb25-2"></a><span class="kw">library</span>(RANN)<span class="co"># Non-normal distributions: bimodel distribution (mixture of two normal distributions)</span></span>
<span id="cb25-3"><a href="#cb25-3"></a><span class="kw">library</span>(boot)</span>
<span id="cb25-4"><a href="#cb25-4"></a><span class="kw">library</span>(energy)</span>
<span id="cb25-5"><a href="#cb25-5"></a><span class="kw">library</span>(Ball)</span>
<span id="cb25-6"><a href="#cb25-6"></a></span>
<span id="cb25-7"><a href="#cb25-7"></a>Tn &lt;-<span class="st"> </span><span class="cf">function</span>(z, ix, sizes,k) {</span>
<span id="cb25-8"><a href="#cb25-8"></a>  n1 &lt;-<span class="st"> </span>sizes[<span class="dv">1</span>]; n2 &lt;-<span class="st"> </span>sizes[<span class="dv">2</span>]; n &lt;-<span class="st"> </span>n1 <span class="op">+</span><span class="st"> </span>n2</span>
<span id="cb25-9"><a href="#cb25-9"></a>  <span class="cf">if</span>(<span class="kw">is.vector</span>(z)) z &lt;-<span class="st"> </span><span class="kw">data.frame</span>(z,<span class="dv">0</span>);</span>
<span id="cb25-10"><a href="#cb25-10"></a>  z &lt;-<span class="st"> </span>z[ix, ];</span>
<span id="cb25-11"><a href="#cb25-11"></a>  NN &lt;-<span class="st"> </span><span class="kw">nn2</span>(<span class="dt">data=</span>z, <span class="dt">k=</span>k<span class="op">+</span><span class="dv">1</span>) <span class="co"># what&#39;s the first column?</span></span>
<span id="cb25-12"><a href="#cb25-12"></a>  block1 &lt;-<span class="st"> </span>NN<span class="op">$</span>nn.idx[<span class="dv">1</span><span class="op">:</span>n1,<span class="op">-</span><span class="dv">1</span>] </span>
<span id="cb25-13"><a href="#cb25-13"></a>  block2 &lt;-<span class="st"> </span>NN<span class="op">$</span>nn.idx[(n1<span class="op">+</span><span class="dv">1</span>)<span class="op">:</span>n,<span class="op">-</span><span class="dv">1</span>] </span>
<span id="cb25-14"><a href="#cb25-14"></a>  i1 &lt;-<span class="st"> </span><span class="kw">sum</span>(block1 <span class="op">&lt;</span><span class="st"> </span>n1 <span class="op">+</span><span class="st"> </span><span class="fl">.5</span>); i2 &lt;-<span class="st"> </span><span class="kw">sum</span>(block2 <span class="op">&gt;</span><span class="st"> </span>n1<span class="fl">+.5</span>) </span>
<span id="cb25-15"><a href="#cb25-15"></a>  (i1 <span class="op">+</span><span class="st"> </span>i2) <span class="op">/</span><span class="st"> </span>(k <span class="op">*</span><span class="st"> </span>n)</span>
<span id="cb25-16"><a href="#cb25-16"></a>}</span>
<span id="cb25-17"><a href="#cb25-17"></a></span>
<span id="cb25-18"><a href="#cb25-18"></a>m &lt;-<span class="st"> </span><span class="fl">1e2</span>; k&lt;-<span class="dv">3</span>; p&lt;-<span class="dv">2</span>; mu &lt;-<span class="st"> </span><span class="fl">0.1</span></span>
<span id="cb25-19"><a href="#cb25-19"></a>n1 &lt;-<span class="st"> </span>n2 &lt;-<span class="st"> </span><span class="dv">50</span>; R&lt;-<span class="dv">999</span>; n &lt;-<span class="st"> </span>n1<span class="op">+</span>n2; N =<span class="st"> </span><span class="kw">c</span>(n1,n2)</span>
<span id="cb25-20"><a href="#cb25-20"></a>eqdist.nn &lt;-<span class="st"> </span><span class="cf">function</span>(z,sizes,k){</span>
<span id="cb25-21"><a href="#cb25-21"></a>  boot.obj &lt;-<span class="st"> </span><span class="kw">boot</span>(<span class="dt">data=</span>z,<span class="dt">statistic=</span>Tn,<span class="dt">R=</span><span class="dv">999</span>,</span>
<span id="cb25-22"><a href="#cb25-22"></a>  <span class="dt">sim =</span> <span class="st">&quot;permutation&quot;</span>, <span class="dt">sizes =</span> N,<span class="dt">k=</span>k)</span>
<span id="cb25-23"><a href="#cb25-23"></a>  ts &lt;-<span class="st"> </span><span class="kw">c</span>(boot.obj<span class="op">$</span>t0,boot.obj<span class="op">$</span>t)</span>
<span id="cb25-24"><a href="#cb25-24"></a>  p.value &lt;-<span class="st"> </span><span class="kw">mean</span>(ts<span class="op">&gt;=</span>ts[<span class="dv">1</span>])</span>
<span id="cb25-25"><a href="#cb25-25"></a>  <span class="kw">list</span>(<span class="dt">statistic=</span>ts[<span class="dv">1</span>],<span class="dt">p.value=</span>p.value)</span>
<span id="cb25-26"><a href="#cb25-26"></a>}</span>
<span id="cb25-27"><a href="#cb25-27"></a></span>
<span id="cb25-28"><a href="#cb25-28"></a>p.values &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA</span>,m,<span class="dv">3</span>)</span>
<span id="cb25-29"><a href="#cb25-29"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>m){</span>
<span id="cb25-30"><a href="#cb25-30"></a>  x &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rnorm</span>(n1<span class="op">*</span>p,<span class="dv">0</span>,<span class="dv">1</span>),<span class="dt">ncol=</span>p);</span>
<span id="cb25-31"><a href="#cb25-31"></a>  y &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="kw">rnorm</span>(n2),<span class="kw">rnorm</span>(n2,<span class="dt">mean=</span>mu));</span>
<span id="cb25-32"><a href="#cb25-32"></a>  z &lt;-<span class="st"> </span><span class="kw">rbind</span>(x,y)</span>
<span id="cb25-33"><a href="#cb25-33"></a>  p.values[i,<span class="dv">1</span>] &lt;-<span class="st"> </span><span class="kw">eqdist.nn</span>(z,N,k)<span class="op">$</span>p.value</span>
<span id="cb25-34"><a href="#cb25-34"></a>  p.values[i,<span class="dv">2</span>] &lt;-<span class="st"> </span><span class="kw">eqdist.etest</span>(z,<span class="dt">sizes=</span>N,<span class="dt">R=</span><span class="dv">999</span>)<span class="op">$</span>p.value</span>
<span id="cb25-35"><a href="#cb25-35"></a>  p.values[i,<span class="dv">3</span>] &lt;-<span class="kw">bd.test</span>(<span class="dt">x=</span>x,<span class="dt">y=</span>y,<span class="dt">num.permutations=</span><span class="dv">999</span>,<span class="dt">seed=</span>i<span class="op">*</span><span class="dv">12345</span>)<span class="op">$</span>p.value</span>
<span id="cb25-36"><a href="#cb25-36"></a>}</span>
<span id="cb25-37"><a href="#cb25-37"></a>p.value1 &lt;-<span class="st"> </span><span class="kw">mean</span>(p.values[i,<span class="dv">1</span>])</span>
<span id="cb25-38"><a href="#cb25-38"></a>p.value2 &lt;-<span class="st"> </span><span class="kw">mean</span>(p.values[i,<span class="dv">2</span>])</span>
<span id="cb25-39"><a href="#cb25-39"></a>p.value3 &lt;-<span class="st"> </span><span class="kw">mean</span>(p.values[i,<span class="dv">3</span>])</span>
<span id="cb25-40"><a href="#cb25-40"></a><span class="kw">round</span>(<span class="kw">c</span>(p.value1,p.value2,p.value3),<span class="dv">3</span>)<span class="co">#Energy test and Ball test are generally less powerful than nearest NN test</span></span></code></pre></div>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a><span class="kw">set.seed</span>(<span class="dv">123456</span>)</span>
<span id="cb26-2"><a href="#cb26-2"></a><span class="kw">library</span>(RANN)<span class="co"># Unbalanced samples (say, 1 case versus 10 controls)</span></span>
<span id="cb26-3"><a href="#cb26-3"></a><span class="kw">library</span>(boot)</span>
<span id="cb26-4"><a href="#cb26-4"></a><span class="kw">library</span>(energy)</span>
<span id="cb26-5"><a href="#cb26-5"></a><span class="kw">library</span>(Ball)</span>
<span id="cb26-6"><a href="#cb26-6"></a></span>
<span id="cb26-7"><a href="#cb26-7"></a>Tn &lt;-<span class="st"> </span><span class="cf">function</span>(z, ix, sizes,k) {</span>
<span id="cb26-8"><a href="#cb26-8"></a>  n1 &lt;-<span class="st"> </span>sizes[<span class="dv">1</span>]; n2 &lt;-<span class="st"> </span>sizes[<span class="dv">2</span>]; n &lt;-<span class="st"> </span>n1 <span class="op">+</span><span class="st"> </span>n2</span>
<span id="cb26-9"><a href="#cb26-9"></a>  <span class="cf">if</span>(<span class="kw">is.vector</span>(z)) z &lt;-<span class="st"> </span><span class="kw">data.frame</span>(z,<span class="dv">0</span>);</span>
<span id="cb26-10"><a href="#cb26-10"></a>  z &lt;-<span class="st"> </span>z[ix, ];</span>
<span id="cb26-11"><a href="#cb26-11"></a>  NN &lt;-<span class="st"> </span><span class="kw">nn2</span>(<span class="dt">data=</span>z, <span class="dt">k=</span>k<span class="op">+</span><span class="dv">1</span>) <span class="co"># what&#39;s the first column?</span></span>
<span id="cb26-12"><a href="#cb26-12"></a>  block1 &lt;-<span class="st"> </span>NN<span class="op">$</span>nn.idx[<span class="dv">1</span><span class="op">:</span>n1,<span class="op">-</span><span class="dv">1</span>] </span>
<span id="cb26-13"><a href="#cb26-13"></a>  block2 &lt;-<span class="st"> </span>NN<span class="op">$</span>nn.idx[(n1<span class="op">+</span><span class="dv">1</span>)<span class="op">:</span>n,<span class="op">-</span><span class="dv">1</span>] </span>
<span id="cb26-14"><a href="#cb26-14"></a>  i1 &lt;-<span class="st"> </span><span class="kw">sum</span>(block1 <span class="op">&lt;</span><span class="st"> </span>n1 <span class="op">+</span><span class="st"> </span><span class="fl">.5</span>); i2 &lt;-<span class="st"> </span><span class="kw">sum</span>(block2 <span class="op">&gt;</span><span class="st"> </span>n1<span class="fl">+.5</span>) </span>
<span id="cb26-15"><a href="#cb26-15"></a>  (i1 <span class="op">+</span><span class="st"> </span>i2) <span class="op">/</span><span class="st"> </span>(k <span class="op">*</span><span class="st"> </span>n)</span>
<span id="cb26-16"><a href="#cb26-16"></a>}</span>
<span id="cb26-17"><a href="#cb26-17"></a></span>
<span id="cb26-18"><a href="#cb26-18"></a>m &lt;-<span class="st"> </span><span class="fl">1e2</span>; k&lt;-<span class="dv">3</span>; p&lt;-<span class="dv">2</span>; mu &lt;-<span class="st"> </span><span class="fl">0.1</span></span>
<span id="cb26-19"><a href="#cb26-19"></a>n1 &lt;-<span class="st"> </span><span class="dv">5</span></span>
<span id="cb26-20"><a href="#cb26-20"></a>n2 &lt;-<span class="st"> </span><span class="dv">50</span>; R&lt;-<span class="dv">999</span>; n &lt;-<span class="st"> </span>n1<span class="op">+</span>n2; N =<span class="st"> </span><span class="kw">c</span>(n1,n2)</span>
<span id="cb26-21"><a href="#cb26-21"></a>eqdist.nn &lt;-<span class="st"> </span><span class="cf">function</span>(z,sizes,k){</span>
<span id="cb26-22"><a href="#cb26-22"></a>  boot.obj &lt;-<span class="st"> </span><span class="kw">boot</span>(<span class="dt">data=</span>z,<span class="dt">statistic=</span>Tn,<span class="dt">R=</span><span class="dv">999</span>,</span>
<span id="cb26-23"><a href="#cb26-23"></a>  <span class="dt">sim =</span> <span class="st">&quot;permutation&quot;</span>, <span class="dt">sizes =</span> N,<span class="dt">k=</span>k)</span>
<span id="cb26-24"><a href="#cb26-24"></a>  ts &lt;-<span class="st"> </span><span class="kw">c</span>(boot.obj<span class="op">$</span>t0,boot.obj<span class="op">$</span>t)</span>
<span id="cb26-25"><a href="#cb26-25"></a>  p.value &lt;-<span class="st"> </span><span class="kw">mean</span>(ts<span class="op">&gt;=</span>ts[<span class="dv">1</span>])</span>
<span id="cb26-26"><a href="#cb26-26"></a>  <span class="kw">list</span>(<span class="dt">statistic=</span>ts[<span class="dv">1</span>],<span class="dt">p.value=</span>p.value)</span>
<span id="cb26-27"><a href="#cb26-27"></a>}</span>
<span id="cb26-28"><a href="#cb26-28"></a></span>
<span id="cb26-29"><a href="#cb26-29"></a>p.values &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA</span>,m,<span class="dv">3</span>)</span>
<span id="cb26-30"><a href="#cb26-30"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>m){</span>
<span id="cb26-31"><a href="#cb26-31"></a>  x &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rnorm</span>(n1<span class="op">*</span>p,<span class="dv">0</span>,<span class="dv">1</span>),<span class="dt">ncol=</span>p);</span>
<span id="cb26-32"><a href="#cb26-32"></a>  y &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="kw">rnorm</span>(n2),<span class="kw">rnorm</span>(n2,<span class="dt">mean=</span>mu));</span>
<span id="cb26-33"><a href="#cb26-33"></a>  z &lt;-<span class="st"> </span><span class="kw">rbind</span>(x,y)</span>
<span id="cb26-34"><a href="#cb26-34"></a>  p.values[i,<span class="dv">1</span>] &lt;-<span class="st"> </span><span class="kw">eqdist.nn</span>(z,N,k)<span class="op">$</span>p.value</span>
<span id="cb26-35"><a href="#cb26-35"></a>  p.values[i,<span class="dv">2</span>] &lt;-<span class="st"> </span><span class="kw">eqdist.etest</span>(z,<span class="dt">sizes=</span>N,<span class="dt">R=</span><span class="dv">999</span>)<span class="op">$</span>p.value</span>
<span id="cb26-36"><a href="#cb26-36"></a>  p.values[i,<span class="dv">3</span>] &lt;-<span class="kw">bd.test</span>(<span class="dt">x=</span>x,<span class="dt">y=</span>y,<span class="dt">num.permutations=</span><span class="dv">999</span>,<span class="dt">seed=</span>i<span class="op">*</span><span class="dv">12345</span>)<span class="op">$</span>p.value</span>
<span id="cb26-37"><a href="#cb26-37"></a>}</span>
<span id="cb26-38"><a href="#cb26-38"></a>p.value1 &lt;-<span class="st"> </span><span class="kw">mean</span>(p.values[i,<span class="dv">1</span>])</span>
<span id="cb26-39"><a href="#cb26-39"></a>p.value2 &lt;-<span class="st"> </span><span class="kw">mean</span>(p.values[i,<span class="dv">2</span>])</span>
<span id="cb26-40"><a href="#cb26-40"></a>p.value3 &lt;-<span class="st"> </span><span class="kw">mean</span>(p.values[i,<span class="dv">3</span>])</span>
<span id="cb26-41"><a href="#cb26-41"></a><span class="kw">round</span>(<span class="kw">c</span>(p.value1,p.value2,p.value3),<span class="dv">3</span>)<span class="co"># nearest NN test and Ball test are generally less powerful than Energy test</span></span></code></pre></div>
</div>
<div id="section-7" class="section level2">
<h2>2020/11/17</h2>
</div>
<div id="question-7" class="section level2">
<h2>Question</h2>
<p>Exercies 9.4 (pages 277, Statistical Computating with R).</p>
<p>For Exercise 9.4, use the Gelman-Rubin method to monitor convergence of the chain, and run the chain until it converges approximately to the target distribution according to ˆR &lt; 1.2.</p>
<p>Exercises 11.4 (pages 353, Statistical Computing with R)</p>
<p>9.4 Implement a random walk Metropolis sampler for generating the standard Laplace distribution (see Exercise 3.2). For the increment, simulate from a normal distribution. Compare the chains generated when different variances are used for the proposal distribution. Also, compute the acceptance rates of each chain.</p>
<p>11.4 Find the intersection points <span class="math inline">\(A(k)\)</span> in <span class="math inline">\((0, \sqrt{k})\)</span> of the curves <span class="math display">\[
S_{k-1}(a)=P\left(t(k-1)&gt;\sqrt{\frac{a^{2}(k-1)}{k-a^{2}}}\right)
\]</span> and <span class="math display">\[
S_{k}(a)=P\left(t(k)&gt;\sqrt{\frac{a^{2} k}{k+1-a^{2}}}\right)
\]</span> for <span class="math inline">\(k=4: 25,100,500,1000,\)</span> where <span class="math inline">\(t(k)\)</span> is a Student <span class="math inline">\(t\)</span> random variable with <span class="math inline">\(k\)</span> degrees of freedom. (These intersection points determine the critical values for a <span class="math inline">\(t\)</span> -test for scale-mixture errors proposed by Székely <span class="math inline">\([260] .)\)</span></p>
</div>
<div id="answer-7" class="section level2">
<h2>Answer</h2>
<p>9.4</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a>rw.Metropolis &lt;-<span class="st"> </span><span class="cf">function</span>(n, sigma, x0, N) {</span>
<span id="cb27-2"><a href="#cb27-2"></a>x &lt;-<span class="st"> </span><span class="kw">numeric</span>(N)</span>
<span id="cb27-3"><a href="#cb27-3"></a>x[<span class="dv">1</span>] &lt;-<span class="st"> </span>x0</span>
<span id="cb27-4"><a href="#cb27-4"></a>mu &lt;-<span class="st"> </span><span class="dv">1</span></span>
<span id="cb27-5"><a href="#cb27-5"></a>b &lt;-<span class="st"> </span><span class="dv">1</span></span>
<span id="cb27-6"><a href="#cb27-6"></a>u &lt;-<span class="st"> </span><span class="kw">runif</span>(N,<span class="op">-</span>.<span class="dv">5</span>,.<span class="dv">5</span>)</span>
<span id="cb27-7"><a href="#cb27-7"></a>R &lt;-<span class="st"> </span>mu<span class="op">-</span>b<span class="op">*</span><span class="kw">sign</span>(u)<span class="op">*</span><span class="kw">log</span>(<span class="dv">1-2</span><span class="op">*</span><span class="kw">abs</span>(u))</span>
<span id="cb27-8"><a href="#cb27-8"></a>k &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb27-9"><a href="#cb27-9"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="op">:</span>N) {</span>
<span id="cb27-10"><a href="#cb27-10"></a>y &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">1</span>, x[i<span class="dv">-1</span>], sigma)</span>
<span id="cb27-11"><a href="#cb27-11"></a><span class="cf">if</span> (R[i] <span class="op">&lt;=</span><span class="st"> </span>(<span class="kw">dt</span>(y, n) <span class="op">/</span><span class="st"> </span><span class="kw">dt</span>(x[i<span class="dv">-1</span>], n)))</span>
<span id="cb27-12"><a href="#cb27-12"></a>x[i] &lt;-<span class="st"> </span>y <span class="cf">else</span> {</span>
<span id="cb27-13"><a href="#cb27-13"></a>x[i] &lt;-<span class="st"> </span>x[i<span class="dv">-1</span>]</span>
<span id="cb27-14"><a href="#cb27-14"></a>k &lt;-<span class="st"> </span>k <span class="op">+</span><span class="st"> </span><span class="dv">1</span></span>
<span id="cb27-15"><a href="#cb27-15"></a>} }</span>
<span id="cb27-16"><a href="#cb27-16"></a><span class="kw">return</span>(<span class="kw">list</span>(<span class="dt">x=</span>x, <span class="dt">k=</span>k))</span>
<span id="cb27-17"><a href="#cb27-17"></a>}</span>
<span id="cb27-18"><a href="#cb27-18"></a>n &lt;-<span class="st"> </span><span class="dv">4</span> <span class="co">#degrees of freedom for target Student t dist.</span></span>
<span id="cb27-19"><a href="#cb27-19"></a>N &lt;-<span class="st"> </span><span class="dv">2000</span></span>
<span id="cb27-20"><a href="#cb27-20"></a>sigma &lt;-<span class="st"> </span><span class="kw">c</span>(.<span class="dv">05</span>, <span class="fl">.5</span>, <span class="dv">2</span>, <span class="dv">5</span>)</span>
<span id="cb27-21"><a href="#cb27-21"></a>x0 &lt;-<span class="st"> </span><span class="dv">25</span></span>
<span id="cb27-22"><a href="#cb27-22"></a>rw1 &lt;-<span class="st"> </span><span class="kw">rw.Metropolis</span>(n, sigma[<span class="dv">1</span>], x0, N)</span>
<span id="cb27-23"><a href="#cb27-23"></a>rw2 &lt;-<span class="st"> </span><span class="kw">rw.Metropolis</span>(n, sigma[<span class="dv">2</span>], x0, N)</span>
<span id="cb27-24"><a href="#cb27-24"></a>rw3 &lt;-<span class="st"> </span><span class="kw">rw.Metropolis</span>(n, sigma[<span class="dv">3</span>], x0, N)</span>
<span id="cb27-25"><a href="#cb27-25"></a>rw4 &lt;-<span class="st"> </span><span class="kw">rw.Metropolis</span>(n, sigma[<span class="dv">4</span>], x0, N)</span>
<span id="cb27-26"><a href="#cb27-26"></a><span class="co">#number of candidate points rejected</span></span>
<span id="cb27-27"><a href="#cb27-27"></a> <span class="kw">print</span>(<span class="kw">c</span>(<span class="dv">1</span><span class="op">-</span>rw1<span class="op">$</span>k<span class="op">/</span>N, <span class="dv">1</span><span class="op">-</span>rw2<span class="op">$</span>k<span class="op">/</span>N, <span class="dv">1</span><span class="op">-</span>rw3<span class="op">$</span>k<span class="op">/</span>N, <span class="dv">1</span><span class="op">-</span>rw4<span class="op">$</span>k<span class="op">/</span>N))</span></code></pre></div>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a>Gelman.Rubin &lt;-<span class="st"> </span><span class="cf">function</span>(psi) {</span>
<span id="cb28-2"><a href="#cb28-2"></a>  <span class="co"># psi[i,j] is the statistic psi(X[i,1:j])</span></span>
<span id="cb28-3"><a href="#cb28-3"></a>  <span class="co"># for chain in i-th row of X</span></span>
<span id="cb28-4"><a href="#cb28-4"></a>  psi &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(psi)</span>
<span id="cb28-5"><a href="#cb28-5"></a>  n &lt;-<span class="st"> </span><span class="kw">ncol</span>(psi)</span>
<span id="cb28-6"><a href="#cb28-6"></a>  k &lt;-<span class="st"> </span><span class="kw">nrow</span>(psi)</span>
<span id="cb28-7"><a href="#cb28-7"></a>  psi.means &lt;-<span class="st"> </span><span class="kw">rowMeans</span>(psi) <span class="co">#row means</span></span>
<span id="cb28-8"><a href="#cb28-8"></a>  B &lt;-<span class="st"> </span>n <span class="op">*</span><span class="st"> </span><span class="kw">var</span>(psi.means) <span class="co">#between variance est.</span></span>
<span id="cb28-9"><a href="#cb28-9"></a>  psi.w &lt;-<span class="st"> </span><span class="kw">apply</span>(psi, <span class="dv">1</span>, <span class="st">&quot;var&quot;</span>) <span class="co">#within variances</span></span>
<span id="cb28-10"><a href="#cb28-10"></a>  W &lt;-<span class="st"> </span><span class="kw">mean</span>(psi.w) <span class="co">#within est.</span></span>
<span id="cb28-11"><a href="#cb28-11"></a>  v.hat &lt;-<span class="st"> </span>W<span class="op">*</span>(n<span class="dv">-1</span>)<span class="op">/</span>n <span class="op">+</span><span class="st"> </span>(B<span class="op">/</span>n) <span class="co">#upper variance est.</span></span>
<span id="cb28-12"><a href="#cb28-12"></a>  r.hat &lt;-<span class="st"> </span>v.hat <span class="op">/</span><span class="st"> </span>W <span class="co">#G-R statistic</span></span>
<span id="cb28-13"><a href="#cb28-13"></a>  <span class="kw">return</span>(r.hat)</span>
<span id="cb28-14"><a href="#cb28-14"></a>}</span>
<span id="cb28-15"><a href="#cb28-15"></a>normal.chain &lt;-<span class="st"> </span><span class="cf">function</span>(sigma, N, X1) {</span>
<span id="cb28-16"><a href="#cb28-16"></a>  <span class="co">#generates a Metropolis chain for Normal(0,1)</span></span>
<span id="cb28-17"><a href="#cb28-17"></a>  <span class="co">#with Normal(X[t], sigma) proposal distribution</span></span>
<span id="cb28-18"><a href="#cb28-18"></a>  <span class="co">#and starting value X1</span></span>
<span id="cb28-19"><a href="#cb28-19"></a>  x &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">0</span>, N)</span>
<span id="cb28-20"><a href="#cb28-20"></a>  x[<span class="dv">1</span>] &lt;-<span class="st"> </span>X1</span>
<span id="cb28-21"><a href="#cb28-21"></a>  <span class="co">#u &lt;- runif(N)</span></span>
<span id="cb28-22"><a href="#cb28-22"></a>  u0 &lt;-<span class="st"> </span><span class="kw">runif</span>(N,<span class="op">-</span>.<span class="dv">5</span>,.<span class="dv">5</span>)</span>
<span id="cb28-23"><a href="#cb28-23"></a>  u &lt;-<span class="st"> </span><span class="dv">1-1</span><span class="op">*</span><span class="kw">sign</span>(u0)<span class="op">*</span><span class="kw">log</span>(<span class="dv">1-2</span><span class="op">*</span><span class="kw">abs</span>(u0))</span>
<span id="cb28-24"><a href="#cb28-24"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="op">:</span>N) {</span>
<span id="cb28-25"><a href="#cb28-25"></a>    xt &lt;-<span class="st"> </span>x[i<span class="dv">-1</span>]</span>
<span id="cb28-26"><a href="#cb28-26"></a>    y &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">1</span>, xt, sigma) <span class="co">#candidate point</span></span>
<span id="cb28-27"><a href="#cb28-27"></a>    r1 &lt;-<span class="st"> </span><span class="kw">dnorm</span>(y, <span class="dv">0</span>, <span class="dv">1</span>) <span class="op">*</span><span class="st"> </span><span class="kw">dnorm</span>(xt, y, sigma)</span>
<span id="cb28-28"><a href="#cb28-28"></a>    r2 &lt;-<span class="st"> </span><span class="kw">dnorm</span>(xt, <span class="dv">0</span>, <span class="dv">1</span>) <span class="op">*</span><span class="st"> </span><span class="kw">dnorm</span>(y, xt, sigma)</span>
<span id="cb28-29"><a href="#cb28-29"></a>    r &lt;-<span class="st"> </span>r1 <span class="op">/</span><span class="st"> </span>r2</span>
<span id="cb28-30"><a href="#cb28-30"></a>    <span class="cf">if</span> (u[i] <span class="op">&lt;=</span><span class="st"> </span>r) x[i] &lt;-<span class="st"> </span>y <span class="cf">else</span></span>
<span id="cb28-31"><a href="#cb28-31"></a>      x[i] &lt;-<span class="st"> </span>xt</span>
<span id="cb28-32"><a href="#cb28-32"></a>  }</span>
<span id="cb28-33"><a href="#cb28-33"></a>  <span class="kw">return</span>(x)</span>
<span id="cb28-34"><a href="#cb28-34"></a>}</span>
<span id="cb28-35"><a href="#cb28-35"></a></span>
<span id="cb28-36"><a href="#cb28-36"></a></span>
<span id="cb28-37"><a href="#cb28-37"></a></span>
<span id="cb28-38"><a href="#cb28-38"></a>sigma &lt;-<span class="st"> </span><span class="fl">.05</span> <span class="co">#parameter of proposal distribution</span></span>
<span id="cb28-39"><a href="#cb28-39"></a><span class="co">#sigma &lt;- c(.05, .5, 2, 4)</span></span>
<span id="cb28-40"><a href="#cb28-40"></a>k &lt;-<span class="st"> </span><span class="dv">4</span> <span class="co">#number of chains to generate</span></span>
<span id="cb28-41"><a href="#cb28-41"></a>n &lt;-<span class="st"> </span><span class="dv">2000</span> <span class="co">#length of chains</span></span>
<span id="cb28-42"><a href="#cb28-42"></a>b &lt;-<span class="st"> </span><span class="dv">1000</span> <span class="co">#burn-in length</span></span>
<span id="cb28-43"><a href="#cb28-43"></a><span class="co">#choose overdispersed initial values</span></span>
<span id="cb28-44"><a href="#cb28-44"></a>x0 &lt;-<span class="st"> </span><span class="dv">25</span></span>
<span id="cb28-45"><a href="#cb28-45"></a><span class="co">#generate the chains</span></span>
<span id="cb28-46"><a href="#cb28-46"></a>X &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">0</span>, <span class="dt">nrow=</span>k, <span class="dt">ncol=</span>n)</span>
<span id="cb28-47"><a href="#cb28-47"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>k)</span>
<span id="cb28-48"><a href="#cb28-48"></a>  X[i, ] &lt;-<span class="st"> </span><span class="kw">normal.chain</span>(sigma, n, x0)</span>
<span id="cb28-49"><a href="#cb28-49"></a><span class="co">#compute diagnostic statistics</span></span>
<span id="cb28-50"><a href="#cb28-50"></a>  psi &lt;-<span class="st"> </span><span class="kw">t</span>(<span class="kw">apply</span>(X, <span class="dv">1</span>, cumsum))</span>
<span id="cb28-51"><a href="#cb28-51"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(psi))</span>
<span id="cb28-52"><a href="#cb28-52"></a>      psi[i,] &lt;-<span class="st"> </span>psi[i,] <span class="op">/</span><span class="st"> </span>(<span class="dv">1</span><span class="op">:</span><span class="kw">ncol</span>(psi))</span>
<span id="cb28-53"><a href="#cb28-53"></a>  <span class="kw">print</span>(<span class="kw">Gelman.Rubin</span>(psi))</span>
<span id="cb28-54"><a href="#cb28-54"></a></span>
<span id="cb28-55"><a href="#cb28-55"></a>sigma &lt;-<span class="st"> </span><span class="fl">.5</span> <span class="co">#parameter of proposal distribution</span></span>
<span id="cb28-56"><a href="#cb28-56"></a><span class="co">#sigma &lt;- c(.05, .5, 2, 16)</span></span>
<span id="cb28-57"><a href="#cb28-57"></a>k &lt;-<span class="st"> </span><span class="dv">4</span> <span class="co">#number of chains to generate</span></span>
<span id="cb28-58"><a href="#cb28-58"></a>n &lt;-<span class="st"> </span><span class="dv">2000</span> <span class="co">#length of chains</span></span>
<span id="cb28-59"><a href="#cb28-59"></a>b &lt;-<span class="st"> </span><span class="dv">1000</span> <span class="co">#burn-in length</span></span>
<span id="cb28-60"><a href="#cb28-60"></a><span class="co">#choose overdispersed initial values</span></span>
<span id="cb28-61"><a href="#cb28-61"></a>x0 &lt;-<span class="st"> </span><span class="dv">25</span></span>
<span id="cb28-62"><a href="#cb28-62"></a><span class="co">#generate the chains</span></span>
<span id="cb28-63"><a href="#cb28-63"></a>X &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">0</span>, <span class="dt">nrow=</span>k, <span class="dt">ncol=</span>n)</span>
<span id="cb28-64"><a href="#cb28-64"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>k)</span>
<span id="cb28-65"><a href="#cb28-65"></a>  X[i, ] &lt;-<span class="st"> </span><span class="kw">normal.chain</span>(sigma, n, x0)</span>
<span id="cb28-66"><a href="#cb28-66"></a><span class="co">#compute diagnostic statistics</span></span>
<span id="cb28-67"><a href="#cb28-67"></a>psi &lt;-<span class="st"> </span><span class="kw">t</span>(<span class="kw">apply</span>(X, <span class="dv">1</span>, cumsum))</span>
<span id="cb28-68"><a href="#cb28-68"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(psi))</span>
<span id="cb28-69"><a href="#cb28-69"></a>  psi[i,] &lt;-<span class="st"> </span>psi[i,] <span class="op">/</span><span class="st"> </span>(<span class="dv">1</span><span class="op">:</span><span class="kw">ncol</span>(psi))</span>
<span id="cb28-70"><a href="#cb28-70"></a><span class="kw">print</span>(<span class="kw">Gelman.Rubin</span>(psi))</span>
<span id="cb28-71"><a href="#cb28-71"></a></span>
<span id="cb28-72"><a href="#cb28-72"></a>sigma &lt;-<span class="st"> </span><span class="dv">2</span> <span class="co">#parameter of proposal distribution</span></span>
<span id="cb28-73"><a href="#cb28-73"></a><span class="co">#sigma &lt;- c(.05, .5, 2, 16)</span></span>
<span id="cb28-74"><a href="#cb28-74"></a>k &lt;-<span class="st"> </span><span class="dv">4</span> <span class="co">#number of chains to generate</span></span>
<span id="cb28-75"><a href="#cb28-75"></a>n &lt;-<span class="st"> </span><span class="dv">2000</span> <span class="co">#length of chains</span></span>
<span id="cb28-76"><a href="#cb28-76"></a>b &lt;-<span class="st"> </span><span class="dv">1000</span> <span class="co">#burn-in length</span></span>
<span id="cb28-77"><a href="#cb28-77"></a><span class="co">#choose overdispersed initial values</span></span>
<span id="cb28-78"><a href="#cb28-78"></a>x0 &lt;-<span class="st"> </span><span class="dv">25</span></span>
<span id="cb28-79"><a href="#cb28-79"></a><span class="co">#generate the chains</span></span>
<span id="cb28-80"><a href="#cb28-80"></a>X &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">0</span>, <span class="dt">nrow=</span>k, <span class="dt">ncol=</span>n)</span>
<span id="cb28-81"><a href="#cb28-81"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>k)</span>
<span id="cb28-82"><a href="#cb28-82"></a>  X[i, ] &lt;-<span class="st"> </span><span class="kw">normal.chain</span>(sigma, n, x0)</span>
<span id="cb28-83"><a href="#cb28-83"></a><span class="co">#compute diagnostic statistics</span></span>
<span id="cb28-84"><a href="#cb28-84"></a>psi &lt;-<span class="st"> </span><span class="kw">t</span>(<span class="kw">apply</span>(X, <span class="dv">1</span>, cumsum))</span>
<span id="cb28-85"><a href="#cb28-85"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(psi))</span>
<span id="cb28-86"><a href="#cb28-86"></a>  psi[i,] &lt;-<span class="st"> </span>psi[i,] <span class="op">/</span><span class="st"> </span>(<span class="dv">1</span><span class="op">:</span><span class="kw">ncol</span>(psi))</span>
<span id="cb28-87"><a href="#cb28-87"></a><span class="kw">print</span>(<span class="kw">Gelman.Rubin</span>(psi))</span>
<span id="cb28-88"><a href="#cb28-88"></a></span>
<span id="cb28-89"><a href="#cb28-89"></a></span>
<span id="cb28-90"><a href="#cb28-90"></a>sigma &lt;-<span class="st"> </span><span class="dv">5</span> <span class="co">#parameter of proposal distribution</span></span>
<span id="cb28-91"><a href="#cb28-91"></a>k &lt;-<span class="st"> </span><span class="dv">4</span> <span class="co">#number of chains to generate</span></span>
<span id="cb28-92"><a href="#cb28-92"></a>n &lt;-<span class="st"> </span><span class="dv">2000</span> <span class="co">#length of chains</span></span>
<span id="cb28-93"><a href="#cb28-93"></a>b &lt;-<span class="st"> </span><span class="dv">1000</span> <span class="co">#burn-in length</span></span>
<span id="cb28-94"><a href="#cb28-94"></a><span class="co">#choose overdispersed initial values</span></span>
<span id="cb28-95"><a href="#cb28-95"></a>x0 &lt;-<span class="st"> </span><span class="dv">25</span></span>
<span id="cb28-96"><a href="#cb28-96"></a><span class="co">#generate the chains</span></span>
<span id="cb28-97"><a href="#cb28-97"></a>X &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">0</span>, <span class="dt">nrow=</span>k, <span class="dt">ncol=</span>n)</span>
<span id="cb28-98"><a href="#cb28-98"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>k)</span>
<span id="cb28-99"><a href="#cb28-99"></a>  X[i, ] &lt;-<span class="st"> </span><span class="kw">normal.chain</span>(sigma, n, x0)</span>
<span id="cb28-100"><a href="#cb28-100"></a><span class="co">#compute diagnostic statistics</span></span>
<span id="cb28-101"><a href="#cb28-101"></a>psi &lt;-<span class="st"> </span><span class="kw">t</span>(<span class="kw">apply</span>(X, <span class="dv">1</span>, cumsum))</span>
<span id="cb28-102"><a href="#cb28-102"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(psi))</span>
<span id="cb28-103"><a href="#cb28-103"></a>  psi[i,] &lt;-<span class="st"> </span>psi[i,] <span class="op">/</span><span class="st"> </span>(<span class="dv">1</span><span class="op">:</span><span class="kw">ncol</span>(psi))</span>
<span id="cb28-104"><a href="#cb28-104"></a><span class="kw">print</span>(<span class="kw">Gelman.Rubin</span>(psi))</span>
<span id="cb28-105"><a href="#cb28-105"></a></span>
<span id="cb28-106"><a href="#cb28-106"></a><span class="co">#Error in if (u[i] &lt;= r) x[i] &lt;- y else x[i] &lt;- xt : Where TRUE/FALSE values are required, missing values cannot be used，In terms of integers, sigma counts up to 5</span></span>
<span id="cb28-107"><a href="#cb28-107"></a><span class="co">#ˆR &lt; 1.2.</span></span></code></pre></div>
<p>11.4</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a>m &lt;-<span class="dv">100</span></span>
<span id="cb29-2"><a href="#cb29-2"></a>int &lt;-<span class="st"> </span><span class="kw">numeric</span>(m)</span>
<span id="cb29-3"><a href="#cb29-3"></a>findpoint &lt;-<span class="st"> </span><span class="cf">function</span>(k,a){</span>
<span id="cb29-4"><a href="#cb29-4"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>m) {</span>
<span id="cb29-5"><a href="#cb29-5"></a>    tk &lt;-<span class="st"> </span><span class="kw">rt</span>(<span class="dv">1</span>,k)</span>
<span id="cb29-6"><a href="#cb29-6"></a>    u &lt;-<span class="st"> </span><span class="kw">sqrt</span>(a<span class="op">^</span><span class="dv">2</span><span class="op">*</span>(k)<span class="op">/</span>(k<span class="op">+</span><span class="dv">1</span><span class="op">-</span>a<span class="op">^</span><span class="dv">2</span>))</span>
<span id="cb29-7"><a href="#cb29-7"></a>    int[i] &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(tk <span class="op">&gt;</span><span class="st"> </span>u)</span>
<span id="cb29-8"><a href="#cb29-8"></a>  }</span>
<span id="cb29-9"><a href="#cb29-9"></a>  <span class="kw">return</span> (<span class="kw">mean</span>(int))</span>
<span id="cb29-10"><a href="#cb29-10"></a>}</span>
<span id="cb29-11"><a href="#cb29-11"></a>findpoint2 &lt;-<span class="st"> </span><span class="cf">function</span>(k){</span>
<span id="cb29-12"><a href="#cb29-12"></a> </span>
<span id="cb29-13"><a href="#cb29-13"></a>  jg &lt;-<span class="st"> </span><span class="kw">numeric</span>(<span class="dv">25</span>)</span>
<span id="cb29-14"><a href="#cb29-14"></a>  f1 &lt;-<span class="st"> </span>f2 &lt;-<span class="st"> </span><span class="kw">numeric</span>(<span class="kw">sqrt</span>(k)<span class="op">*</span><span class="dv">10</span>)</span>
<span id="cb29-15"><a href="#cb29-15"></a>  j &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb29-16"><a href="#cb29-16"></a>  i &lt;-<span class="dv">1</span></span>
<span id="cb29-17"><a href="#cb29-17"></a>  <span class="cf">while</span> (j <span class="op">&lt;</span><span class="st"> </span><span class="kw">sqrt</span>(k)) {</span>
<span id="cb29-18"><a href="#cb29-18"></a>    f1[i] &lt;-<span class="st"> </span><span class="kw">findpoint</span>(k,j)</span>
<span id="cb29-19"><a href="#cb29-19"></a>    f2[i] &lt;-<span class="st"> </span><span class="kw">findpoint</span>(k<span class="dv">-1</span>,j)</span>
<span id="cb29-20"><a href="#cb29-20"></a>    i &lt;-<span class="st"> </span>i <span class="op">+</span><span class="st"> </span><span class="dv">1</span></span>
<span id="cb29-21"><a href="#cb29-21"></a>    j &lt;-<span class="st"> </span>j <span class="op">+</span><span class="st"> </span><span class="fl">0.1</span></span>
<span id="cb29-22"><a href="#cb29-22"></a>  }</span>
<span id="cb29-23"><a href="#cb29-23"></a>  m1 &lt;-<span class="st"> </span><span class="kw">lowess</span>(f1, <span class="dt">y=</span><span class="ot">NULL</span>, <span class="dt">f =</span> <span class="dv">2</span><span class="op">/</span><span class="dv">3</span>, <span class="dt">iter =</span> <span class="dv">3</span>)</span>
<span id="cb29-24"><a href="#cb29-24"></a>  m2 &lt;-<span class="st"> </span><span class="kw">lowess</span>(f2, <span class="dt">y=</span><span class="ot">NULL</span>, <span class="dt">f =</span> <span class="dv">2</span><span class="op">/</span><span class="dv">3</span>, <span class="dt">iter =</span> <span class="dv">3</span>)</span>
<span id="cb29-25"><a href="#cb29-25"></a>  <span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(f1)) {</span>
<span id="cb29-26"><a href="#cb29-26"></a>    <span class="cf">if</span> (<span class="kw">isTRUE</span>(<span class="kw">all.equal</span>(f1[k],f2[k])))</span>
<span id="cb29-27"><a href="#cb29-27"></a>    {</span>
<span id="cb29-28"><a href="#cb29-28"></a>      jg &lt;-<span class="st"> </span>k<span class="op">*</span><span class="fl">0.1</span></span>
<span id="cb29-29"><a href="#cb29-29"></a>      <span class="cf">break</span></span>
<span id="cb29-30"><a href="#cb29-30"></a>      <span class="co">#only find one point(minpoint)</span></span>
<span id="cb29-31"><a href="#cb29-31"></a>    }</span>
<span id="cb29-32"><a href="#cb29-32"></a>    </span>
<span id="cb29-33"><a href="#cb29-33"></a>  }</span>
<span id="cb29-34"><a href="#cb29-34"></a>  <span class="kw">return</span> (jg)</span>
<span id="cb29-35"><a href="#cb29-35"></a>}</span>
<span id="cb29-36"><a href="#cb29-36"></a>r &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">4</span><span class="op">:</span><span class="dv">25</span>,<span class="dv">100</span>,<span class="dv">500</span>,<span class="dv">1000</span>)</span>
<span id="cb29-37"><a href="#cb29-37"></a>jg2 &lt;-<span class="st"> </span><span class="kw">numeric</span>(<span class="dv">25</span>)</span>
<span id="cb29-38"><a href="#cb29-38"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">25</span>) {</span>
<span id="cb29-39"><a href="#cb29-39"></a>  k &lt;-<span class="st"> </span>r[i]</span>
<span id="cb29-40"><a href="#cb29-40"></a>  jg2[i] &lt;-<span class="st"> </span><span class="kw">findpoint2</span>(k)</span>
<span id="cb29-41"><a href="#cb29-41"></a>}</span>
<span id="cb29-42"><a href="#cb29-42"></a></span>
<span id="cb29-43"><a href="#cb29-43"></a><span class="kw">print</span>(<span class="kw">c</span>(jg2))</span>
<span id="cb29-44"><a href="#cb29-44"></a><span class="co">#no matter </span></span>
<span id="cb29-45"><a href="#cb29-45"></a><span class="co">#for (n in 1:25) {</span></span>
<span id="cb29-46"><a href="#cb29-46"></a></span>
<span id="cb29-47"><a href="#cb29-47"></a> <span class="co"># for (j in 1:sqrt(k)) {</span></span>
<span id="cb29-48"><a href="#cb29-48"></a>   <span class="co"># f1[j] &lt;- findpoint(k,j)</span></span>
<span id="cb29-49"><a href="#cb29-49"></a>  <span class="co">#  f2[j] &lt;- findpoint(k-1,j)</span></span>
<span id="cb29-50"><a href="#cb29-50"></a><span class="co">#}</span></span>
<span id="cb29-51"><a href="#cb29-51"></a></span>
<span id="cb29-52"><a href="#cb29-52"></a></span>
<span id="cb29-53"><a href="#cb29-53"></a>  <span class="co">#f &lt;- findpoint(k-1,a)</span></span>
<span id="cb29-54"><a href="#cb29-54"></a><span class="co">#plot(f1)</span></span>
<span id="cb29-55"><a href="#cb29-55"></a><span class="co">#m1 &lt;- lowess(f1, y=NULL, f = 2/3, iter = 3)</span></span>
<span id="cb29-56"><a href="#cb29-56"></a><span class="co">#lines(lowess(m1$x,m1$y))</span></span>
<span id="cb29-57"><a href="#cb29-57"></a><span class="co">#plot(m1$x,m1$y)</span></span>
<span id="cb29-58"><a href="#cb29-58"></a></span>
<span id="cb29-59"><a href="#cb29-59"></a><span class="co">#plot(f2)</span></span>
<span id="cb29-60"><a href="#cb29-60"></a><span class="co">#m2 &lt;- lowess(f2, y=NULL, f = 2/3, iter = 3)</span></span>
<span id="cb29-61"><a href="#cb29-61"></a><span class="co">#lines(lowess(m2$x,m2$y))</span></span>
<span id="cb29-62"><a href="#cb29-62"></a><span class="co">#plot(m2$x,m2$y)</span></span>
<span id="cb29-63"><a href="#cb29-63"></a><span class="co">#}</span></span>
<span id="cb29-64"><a href="#cb29-64"></a></span>
<span id="cb29-65"><a href="#cb29-65"></a><span class="co">#jg</span></span></code></pre></div>
</div>
<div id="section-8" class="section level2">
<h2>2020/11/24</h2>
</div>
<div id="question-8" class="section level2">
<h2>Question</h2>
<p>1.A-B-O blood type problem . Let the three alleles be <span class="math inline">\(A, B,\)</span> and <span class="math inline">\(O\)</span>.</p>
<table>
<thead>
<tr class="header">
<th>Genotype</th>
<th>AA</th>
<th>BB</th>
<th>OO</th>
<th>AO</th>
<th>BO</th>
<th>AB</th>
<th>Sum</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Frequency</td>
<td>p^2</td>
<td>q^2</td>
<td>r^2</td>
<td>2pr</td>
<td>2qr</td>
<td>2pq</td>
<td>1</td>
</tr>
<tr class="even">
<td>Count</td>
<td>nAA</td>
<td>nBB</td>
<td>nOO</td>
<td>nAO</td>
<td>nBO</td>
<td>nAB</td>
<td>n</td>
</tr>
</tbody>
</table>
<p>Observed data: <span class="math inline">\(n_{A \cdot}=n_{A A}+n_{A O}=444(\mathrm{~A}-\mathrm{type})\)</span>, <span class="math inline">\(n_{B \cdot}=n_{B B}+n_{B O}=132(\)</span> B-type <span class="math inline">\(), n_{O O}=361(\)</span> O-type <span class="math inline">\()\)</span>, <span class="math inline">\(n_{A B}=63(\mathrm{AB}-\mathrm{type})\)</span>.</p>
<p>Use EM algorithm to solve MLE of <span class="math inline">\(p\)</span> and <span class="math inline">\(q\)</span> (consider missing data <span class="math inline">\(n_{A A}\)</span> and <span class="math inline">\(\left.n_{B B}\right)\)</span></p>
<p>Record the values of <span class="math inline">\(p\)</span> and <span class="math inline">\(q\)</span> that maximize the conditional likelihood in each EM steps, calculate the corresponding log-maximum likelihood values (for observed data), are they increasing?</p>
<p>2.Exercises 3 (page 204, Advanced R).</p>
<p>(3). Use both for loops and lapply() to fit linear models to the mtcars using the formulas stored in this list: formulas &lt;- list( mpg ~ disp, mpg ~ I(1 / disp), mpg ~ disp + wt, mpg ~ I(1 / disp) + wt )</p>
<p>3.Excecises 3 and 6 (page 213 -214, Advanced R). Note: the anonymous function is defined in Section 10.2 (page 181 , Advanced <span class="math inline">\(\mathrm{R}\)</span> )</p>
<p>(3). The following code simulates the performance of a t-test for non-normal data. Use sapply() and an anonymous function to extract the p-value from every trial.</p>
<p>trials &lt;- replicate( 100, t.test(rpois(10, 10), rpois(7, 10)), simplify = FALSE )</p>
<p>Extra challenge: get rid of the anonymous function by using [[ directly.</p>
<p>(6). Implement a combination of Map() and vapply() to create an lapply() variant that iterates in parallel over all of its inputs and stores its outputs in a vector (or a matrix). What arguments should the function take?</p>
</div>
<div id="answer-8" class="section level2">
<h2>Answer</h2>
<ol style="list-style-type: decimal">
<li></li>
</ol>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a>na&lt;-<span class="dv">444</span> </span>
<span id="cb30-2"><a href="#cb30-2"></a>nb&lt;-<span class="dv">132</span> </span>
<span id="cb30-3"><a href="#cb30-3"></a>noo&lt;-<span class="dv">361</span></span>
<span id="cb30-4"><a href="#cb30-4"></a>nab&lt;-<span class="dv">63</span></span>
<span id="cb30-5"><a href="#cb30-5"></a>n&lt;-na<span class="op">+</span>nb<span class="op">+</span>noo<span class="op">+</span>nab</span>
<span id="cb30-6"><a href="#cb30-6"></a>r0&lt;-<span class="kw">sqrt</span>(noo<span class="op">/</span>n)<span class="co">#</span></span>
<span id="cb30-7"><a href="#cb30-7"></a>p0&lt;-<span class="fl">0.5</span></span>
<span id="cb30-8"><a href="#cb30-8"></a>q0&lt;-<span class="fl">0.5</span></span>
<span id="cb30-9"><a href="#cb30-9"></a></span>
<span id="cb30-10"><a href="#cb30-10"></a>kp &lt;-<span class="st"> </span>(nab <span class="op">+</span><span class="st"> </span><span class="dv">2</span><span class="op">*</span>na<span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>q0)<span class="op">/</span>(<span class="dv">2</span><span class="op">-</span>p0<span class="dv">-2</span><span class="op">*</span>q0))<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>n) </span>
<span id="cb30-11"><a href="#cb30-11"></a>kq &lt;-<span class="st"> </span>(nab <span class="op">+</span><span class="st"> </span><span class="dv">2</span><span class="op">*</span>nb<span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>p0)<span class="op">/</span>(<span class="dv">2-2</span><span class="op">*</span>p0<span class="op">-</span>q0))<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>n)</span>
<span id="cb30-12"><a href="#cb30-12"></a>ko &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">-</span>kp<span class="op">-</span>kq</span>
<span id="cb30-13"><a href="#cb30-13"></a>m&lt;-<span class="dv">100</span></span>
<span id="cb30-14"><a href="#cb30-14"></a>p&lt;-q&lt;-r&lt;-<span class="kw">numeric</span>(m)</span>
<span id="cb30-15"><a href="#cb30-15"></a>q[<span class="dv">1</span>]&lt;-kq</span>
<span id="cb30-16"><a href="#cb30-16"></a>p[<span class="dv">1</span>]&lt;-kp</span>
<span id="cb30-17"><a href="#cb30-17"></a>r[<span class="dv">1</span>]&lt;-r0</span>
<span id="cb30-18"><a href="#cb30-18"></a></span>
<span id="cb30-19"><a href="#cb30-19"></a>like_lihood &lt;-<span class="st"> </span><span class="kw">numeric</span>(m)</span>
<span id="cb30-20"><a href="#cb30-20"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="op">:</span>m) {</span>
<span id="cb30-21"><a href="#cb30-21"></a>  kp&lt;-(nab <span class="op">+</span><span class="st"> </span><span class="dv">2</span><span class="op">*</span>na<span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>q[i<span class="dv">-1</span>])<span class="op">/</span>(<span class="dv">2</span><span class="op">-</span>p[i<span class="dv">-1</span>]<span class="op">-</span><span class="dv">2</span><span class="op">*</span>q[i<span class="dv">-1</span>]))<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>n)</span>
<span id="cb30-22"><a href="#cb30-22"></a>  kq&lt;-(nab <span class="op">+</span><span class="st"> </span><span class="dv">2</span><span class="op">*</span>nb<span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>p[i<span class="dv">-1</span>])<span class="op">/</span>(<span class="dv">2-2</span><span class="op">*</span>p[i<span class="dv">-1</span>]<span class="op">-</span>q[i<span class="dv">-1</span>]))<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>n)</span>
<span id="cb30-23"><a href="#cb30-23"></a>  q[i]&lt;-kq</span>
<span id="cb30-24"><a href="#cb30-24"></a>  p[i]&lt;-kp</span>
<span id="cb30-25"><a href="#cb30-25"></a>  r[i]&lt;-r0</span>
<span id="cb30-26"><a href="#cb30-26"></a>  like_lihood[i] &lt;-<span class="st"> </span>(<span class="dv">2</span><span class="op">*</span>p[i]<span class="op">*</span>q[i])<span class="op">^</span>nab<span class="op">+</span>r[i]<span class="op">^</span>(<span class="dv">2</span><span class="op">*</span>noo)<span class="op">+</span>(<span class="dv">2</span><span class="op">*</span>p[i]<span class="op">*</span>r[i])<span class="op">^</span>na<span class="op">+</span>(<span class="dv">2</span><span class="op">*</span>q[i]<span class="op">*</span>r[i])<span class="op">^</span>nb<span class="op">+</span>(p[i]<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>r[i]))<span class="op">^</span>((na<span class="op">*</span>p[i])<span class="op">/</span>(p[i]<span class="op">+</span><span class="dv">2</span><span class="op">*</span>r[i]))<span class="op">+</span>(q[i]<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>r[i]))<span class="op">^</span>((nb<span class="op">*</span>q[i])<span class="op">/</span>(q[i]<span class="op">+</span><span class="dv">2</span><span class="op">*</span>r[i]))</span>
<span id="cb30-27"><a href="#cb30-27"></a>}</span>
<span id="cb30-28"><a href="#cb30-28"></a></span>
<span id="cb30-29"><a href="#cb30-29"></a><span class="kw">plot</span>(like_lihood)<span class="co">#they are increasing</span></span>
<span id="cb30-30"><a href="#cb30-30"></a><span class="kw">c</span>(p[m],q[m])</span></code></pre></div>
<p>2.(3)</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a>x &lt;-<span class="st"> </span>mtcars</span>
<span id="cb31-2"><a href="#cb31-2"></a>formu &lt;-<span class="st"> </span><span class="kw">list</span>(</span>
<span id="cb31-3"><a href="#cb31-3"></a>mtcars<span class="op">$</span>mpg <span class="op">~</span><span class="st"> </span>mtcars<span class="op">$</span>disp,</span>
<span id="cb31-4"><a href="#cb31-4"></a>mtcars<span class="op">$</span>mpg <span class="op">~</span><span class="st"> </span><span class="kw">I</span>(<span class="dv">1</span> <span class="op">/</span><span class="st"> </span>mtcars<span class="op">$</span>disp),</span>
<span id="cb31-5"><a href="#cb31-5"></a>mtcars<span class="op">$</span>mpg <span class="op">~</span><span class="st"> </span>mtcars<span class="op">$</span>disp <span class="op">+</span><span class="st"> </span>mtcars<span class="op">$</span>wt,</span>
<span id="cb31-6"><a href="#cb31-6"></a>mtcars<span class="op">$</span>mpg <span class="op">~</span><span class="st"> </span><span class="kw">I</span>(<span class="dv">1</span> <span class="op">/</span><span class="st"> </span>mtcars<span class="op">$</span>disp) <span class="op">+</span><span class="st"> </span>mtcars<span class="op">$</span>wt</span>
<span id="cb31-7"><a href="#cb31-7"></a>)</span>
<span id="cb31-8"><a href="#cb31-8"></a>l &lt;-<span class="st"> </span><span class="kw">length</span>(formu)</span>
<span id="cb31-9"><a href="#cb31-9"></a>mt &lt;-<span class="st"> </span><span class="kw">numeric</span>(l)</span>
<span id="cb31-10"><a href="#cb31-10"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>l) {</span>
<span id="cb31-11"><a href="#cb31-11"></a>  mt[i] &lt;-<span class="st"> </span><span class="kw">lapply</span>(x,<span class="cf">function</span>(x) <span class="kw">lm</span>(formu[[i]]))<span class="co">#y = a + bx</span></span>
<span id="cb31-12"><a href="#cb31-12"></a>}</span>
<span id="cb31-13"><a href="#cb31-13"></a> </span>
<span id="cb31-14"><a href="#cb31-14"></a>y &lt;-<span class="st"> </span>x_true &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">0</span>,<span class="dv">4</span>,<span class="kw">length</span>(mtcars<span class="op">$</span>disp))<span class="co">#</span></span>
<span id="cb31-15"><a href="#cb31-15"></a>x_true[<span class="dv">1</span>,] &lt;-<span class="st"> </span>mtcars<span class="op">$</span>disp</span>
<span id="cb31-16"><a href="#cb31-16"></a>x_true[<span class="dv">2</span>,] &lt;-<span class="st"> </span><span class="kw">I</span>(<span class="dv">1</span> <span class="op">/</span><span class="st"> </span>mtcars<span class="op">$</span>disp)</span>
<span id="cb31-17"><a href="#cb31-17"></a>x_true[<span class="dv">3</span>,] &lt;-<span class="st"> </span>mtcars<span class="op">$</span>disp <span class="op">+</span><span class="st"> </span>mtcars<span class="op">$</span>wt</span>
<span id="cb31-18"><a href="#cb31-18"></a>x_true[<span class="dv">4</span>,] &lt;-<span class="st"> </span><span class="kw">I</span>(<span class="dv">1</span> <span class="op">/</span><span class="st"> </span>mtcars<span class="op">$</span>disp) <span class="op">+</span><span class="st"> </span>mtcars<span class="op">$</span>wt</span>
<span id="cb31-19"><a href="#cb31-19"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>l) {</span>
<span id="cb31-20"><a href="#cb31-20"></a>  a &lt;-<span class="st"> </span>mt[[i]][[<span class="st">&quot;coefficients&quot;</span>]][<span class="dv">1</span>]</span>
<span id="cb31-21"><a href="#cb31-21"></a>  b &lt;-<span class="st"> </span>mt[[i]][[<span class="st">&quot;coefficients&quot;</span>]][<span class="dv">2</span>]</span>
<span id="cb31-22"><a href="#cb31-22"></a>  y[i,] &lt;-<span class="st"> </span>a <span class="op">+</span><span class="st"> </span>b <span class="op">*</span><span class="st"> </span>x_true[i,]</span>
<span id="cb31-23"><a href="#cb31-23"></a>  <span class="kw">plot</span>(x_true[i,], y[i,])</span>
<span id="cb31-24"><a href="#cb31-24"></a>  <span class="kw">lines</span>(x_true[i,],y[i,])</span>
<span id="cb31-25"><a href="#cb31-25"></a>}</span></code></pre></div>
<p>3.(3)</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a><span class="kw">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb32-2"><a href="#cb32-2"></a>trials &lt;-<span class="st"> </span><span class="kw">replicate</span>(<span class="dv">100</span>, <span class="kw">t.test</span>(<span class="kw">rpois</span>(<span class="dv">10</span>, <span class="dv">10</span>), <span class="kw">rpois</span>(<span class="dv">7</span>, <span class="dv">10</span>)),<span class="dt">simplify =</span> <span class="ot">FALSE</span>)</span>
<span id="cb32-3"><a href="#cb32-3"></a><span class="co">#x &lt;- trials[[i]]$p.value</span></span>
<span id="cb32-4"><a href="#cb32-4"></a><span class="kw">sapply</span>(trials,<span class="cf">function</span>(x) <span class="kw">list</span>(x<span class="op">$</span>p.value))</span></code></pre></div>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a><span class="co">#Extra challenge</span></span>
<span id="cb33-2"><a href="#cb33-2"></a><span class="co">#trials &lt;- replicate(100, t.test(rpois(10, 10), rpois(7, 10)),simplify = FALSE)</span></span>
<span id="cb33-3"><a href="#cb33-3"></a><span class="co">#x &lt;- trials[[i]]$p.value</span></span>
<span id="cb33-4"><a href="#cb33-4"></a><span class="co">#for (i in 1:length(trials)) {</span></span>
<span id="cb33-5"><a href="#cb33-5"></a><span class="co">#i &lt;- 1</span></span>
<span id="cb33-6"><a href="#cb33-6"></a><span class="co">#  (function(x) print(as.vector(x[[i]]$p.value)))(trials)</span></span>
<span id="cb33-7"><a href="#cb33-7"></a><span class="co">#}</span></span>
<span id="cb33-8"><a href="#cb33-8"></a> <span class="kw">sapply</span>(trials,<span class="st">&quot;[[&quot;</span>,<span class="st">&quot;p.value&quot;</span>)</span></code></pre></div>
<p>3.(6)</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a>testlist &lt;-<span class="st"> </span><span class="kw">list</span>(iris, mtcars) </span>
<span id="cb34-2"><a href="#cb34-2"></a><span class="co">#testlist &lt;- list(rnorm(1000), runif(1000), rpois(1000,100))</span></span>
<span id="cb34-3"><a href="#cb34-3"></a><span class="co">#system.time(lmapply(testlist, mean, numeric(1)))</span></span>
<span id="cb34-4"><a href="#cb34-4"></a><span class="co">#system.time(vapply(testlist, mean, numeric(1)))</span></span>
<span id="cb34-5"><a href="#cb34-5"></a><span class="co">#system.time(Map(mean, testlist))</span></span>
<span id="cb34-6"><a href="#cb34-6"></a>lmapply &lt;-<span class="st"> </span><span class="cf">function</span>(X, FUN, FUN.VALUE, <span class="dt">simplify =</span> <span class="ot">FALSE</span>){ </span>
<span id="cb34-7"><a href="#cb34-7"></a>out &lt;-<span class="st"> </span><span class="kw">Map</span>(<span class="cf">function</span>(x) <span class="kw">vapply</span>(x, FUN, FUN.VALUE), X) </span>
<span id="cb34-8"><a href="#cb34-8"></a><span class="cf">if</span>(simplify <span class="op">==</span><span class="st"> </span><span class="ot">TRUE</span>){<span class="kw">return</span>(<span class="kw">simplify2array</span>(out))} </span>
<span id="cb34-9"><a href="#cb34-9"></a>out &lt;-<span class="st"> </span><span class="kw">as.array.default</span>(out)</span>
<span id="cb34-10"><a href="#cb34-10"></a>out</span>
<span id="cb34-11"><a href="#cb34-11"></a>} </span>
<span id="cb34-12"><a href="#cb34-12"></a><span class="kw">lmapply</span>(testlist, mean, <span class="kw">numeric</span>(<span class="dv">1</span>))</span>
<span id="cb34-13"><a href="#cb34-13"></a>m &lt;-<span class="st"> </span><span class="kw">lmapply</span>(testlist, mean, <span class="kw">numeric</span>(<span class="dv">1</span>)) </span>
<span id="cb34-14"><a href="#cb34-14"></a><span class="kw">class</span>(m)</span></code></pre></div>
<p>Function nested vapply in map</p>
</div>
<div id="section-9" class="section level2">
<h2>2020/12/01</h2>
</div>
<div id="question-9" class="section level2">
<h2>Question</h2>
<ul>
<li>Write an Rcpp function for Exercise 9.4 (page 277, Statistical Computing with R).</li>
</ul>
<p>9.4 Implement a random walk Metropolis sampler for generating the standard Laplace distribution (see Exercise 3.2). For the increment, simulate from a normal distribution. Compare the chains generated when different variances are used for the proposal distribution. Also, compute the acceptance rates of each chain.</p>
<ul>
<li><p>Compare the corresponding generated random numbers with those by the R function you wrote before using the function “qqplot”.</p></li>
<li><p>Campare the computation time of the two functions with the function “microbenchmark”.</p></li>
<li><p>Comments your results</p></li>
</ul>
</div>
<div id="answer-9" class="section level2">
<h2>Answer</h2>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a><span class="kw">library</span>(Rcpp)</span>
<span id="cb35-2"><a href="#cb35-2"></a>dir_cpp &lt;-<span class="st"> &#39;../Rcpp/&#39;</span></span>
<span id="cb35-3"><a href="#cb35-3"></a><span class="co"># Can create source file in Rstudio</span></span>
<span id="cb35-4"><a href="#cb35-4"></a><span class="kw">sourceCpp</span>(<span class="kw">paste0</span>(dir_cpp,<span class="st">&quot;rw_MetropolisC.cpp&quot;</span>))</span>
<span id="cb35-5"><a href="#cb35-5"></a><span class="kw">library</span>(microbenchmark)</span>
<span id="cb35-6"><a href="#cb35-6"></a></span>
<span id="cb35-7"><a href="#cb35-7"></a>rw.Metropolis &lt;-<span class="st"> </span><span class="cf">function</span>(n, sigma, x0, N) {</span>
<span id="cb35-8"><a href="#cb35-8"></a>x &lt;-<span class="st"> </span><span class="kw">numeric</span>(N)</span>
<span id="cb35-9"><a href="#cb35-9"></a>x[<span class="dv">1</span>] &lt;-<span class="st"> </span>x0</span>
<span id="cb35-10"><a href="#cb35-10"></a>mu &lt;-<span class="st"> </span><span class="dv">1</span></span>
<span id="cb35-11"><a href="#cb35-11"></a>b &lt;-<span class="st"> </span><span class="dv">1</span></span>
<span id="cb35-12"><a href="#cb35-12"></a>u &lt;-<span class="st"> </span><span class="kw">runif</span>(N,<span class="op">-</span>.<span class="dv">5</span>,.<span class="dv">5</span>)</span>
<span id="cb35-13"><a href="#cb35-13"></a>R &lt;-<span class="st"> </span>mu<span class="op">-</span>b<span class="op">*</span><span class="kw">sign</span>(u)<span class="op">*</span><span class="kw">log</span>(<span class="dv">1-2</span><span class="op">*</span><span class="kw">abs</span>(u))</span>
<span id="cb35-14"><a href="#cb35-14"></a>k &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb35-15"><a href="#cb35-15"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="op">:</span>N) {</span>
<span id="cb35-16"><a href="#cb35-16"></a>y &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">1</span>, x[i<span class="dv">-1</span>], sigma)</span>
<span id="cb35-17"><a href="#cb35-17"></a><span class="cf">if</span> (R[i] <span class="op">&lt;=</span><span class="st"> </span>(<span class="kw">dt</span>(y, n) <span class="op">/</span><span class="st"> </span><span class="kw">dt</span>(x[i<span class="dv">-1</span>], n)))</span>
<span id="cb35-18"><a href="#cb35-18"></a>x[i] &lt;-<span class="st"> </span>y <span class="cf">else</span> {</span>
<span id="cb35-19"><a href="#cb35-19"></a>x[i] &lt;-<span class="st"> </span>x[i<span class="dv">-1</span>]</span>
<span id="cb35-20"><a href="#cb35-20"></a>k &lt;-<span class="st"> </span>k <span class="op">+</span><span class="st"> </span><span class="dv">1</span></span>
<span id="cb35-21"><a href="#cb35-21"></a>} }</span>
<span id="cb35-22"><a href="#cb35-22"></a><span class="kw">return</span>(<span class="kw">list</span>(<span class="dt">x=</span>x, <span class="dt">k=</span>k))</span>
<span id="cb35-23"><a href="#cb35-23"></a>}</span>
<span id="cb35-24"><a href="#cb35-24"></a><span class="co">#</span></span>
<span id="cb35-25"><a href="#cb35-25"></a><span class="co">#Random number comparison (acceptance rate)</span></span>
<span id="cb35-26"><a href="#cb35-26"></a><span class="co">#</span></span>
<span id="cb35-27"><a href="#cb35-27"></a>n &lt;-<span class="st"> </span><span class="dv">4</span> <span class="co">#degrees of freedom for target Student t dist.</span></span>
<span id="cb35-28"><a href="#cb35-28"></a>N &lt;-<span class="st"> </span><span class="dv">2000</span></span>
<span id="cb35-29"><a href="#cb35-29"></a>sigma &lt;-<span class="st"> </span><span class="kw">c</span>(.<span class="dv">05</span>, <span class="fl">.5</span>, <span class="dv">2</span>, <span class="dv">5</span>)</span>
<span id="cb35-30"><a href="#cb35-30"></a>x0 &lt;-<span class="st"> </span><span class="dv">25</span></span>
<span id="cb35-31"><a href="#cb35-31"></a></span>
<span id="cb35-32"><a href="#cb35-32"></a>rw1 &lt;-<span class="st"> </span><span class="kw">rw.Metropolis</span>(n, sigma[<span class="dv">1</span>], x0, N)</span>
<span id="cb35-33"><a href="#cb35-33"></a>rw2 &lt;-<span class="st"> </span><span class="kw">rw.Metropolis</span>(n, sigma[<span class="dv">2</span>], x0, N)</span>
<span id="cb35-34"><a href="#cb35-34"></a>rw3 &lt;-<span class="st"> </span><span class="kw">rw.Metropolis</span>(n, sigma[<span class="dv">3</span>], x0, N)</span>
<span id="cb35-35"><a href="#cb35-35"></a>rw4 &lt;-<span class="st"> </span><span class="kw">rw.Metropolis</span>(n, sigma[<span class="dv">4</span>], x0, N)<span class="co">#number of candidate points rejected</span></span>
<span id="cb35-36"><a href="#cb35-36"></a> <span class="kw">print</span>(<span class="kw">c</span>(<span class="dv">1</span><span class="op">-</span>rw1<span class="op">$</span>k<span class="op">/</span>N, <span class="dv">1</span><span class="op">-</span>rw2<span class="op">$</span>k<span class="op">/</span>N, <span class="dv">1</span><span class="op">-</span>rw3<span class="op">$</span>k<span class="op">/</span>N, <span class="dv">1</span><span class="op">-</span>rw4<span class="op">$</span>k<span class="op">/</span>N))</span>
<span id="cb35-37"><a href="#cb35-37"></a>rw1C &lt;-<span class="st"> </span><span class="kw">rw_MetropolisC</span>(sigma[<span class="dv">1</span>], x0, N)</span>
<span id="cb35-38"><a href="#cb35-38"></a>rw2C &lt;-<span class="st"> </span><span class="kw">rw_MetropolisC</span>(sigma[<span class="dv">2</span>], x0, N)</span>
<span id="cb35-39"><a href="#cb35-39"></a>rw3C &lt;-<span class="st"> </span><span class="kw">rw_MetropolisC</span>(sigma[<span class="dv">3</span>], x0, N)</span>
<span id="cb35-40"><a href="#cb35-40"></a>rw4C &lt;-<span class="st"> </span><span class="kw">rw_MetropolisC</span>(sigma[<span class="dv">4</span>], x0, N)</span>
<span id="cb35-41"><a href="#cb35-41"></a><span class="kw">print</span>(<span class="kw">c</span>(rw1C[[<span class="dv">2</span>]]<span class="op">/</span>N, rw2C[[<span class="dv">2</span>]]<span class="op">/</span>N, rw3C[[<span class="dv">2</span>]]<span class="op">/</span>N, rw4C[[<span class="dv">2</span>]]<span class="op">/</span>N))</span>
<span id="cb35-42"><a href="#cb35-42"></a><span class="co">#</span></span>
<span id="cb35-43"><a href="#cb35-43"></a><span class="co">#In terms of acceptance rate, the latter has a lower acceptance rate</span></span>
<span id="cb35-44"><a href="#cb35-44"></a><span class="co">#</span></span>
<span id="cb35-45"><a href="#cb35-45"></a>ts &lt;-<span class="st"> </span><span class="kw">microbenchmark</span>(<span class="dt">rw.MetropolisR=</span><span class="kw">rw.Metropolis</span>(n, sigma[<span class="dv">1</span>], x0, N),<span class="dt">meanR2=</span><span class="kw">rw_MetropolisC</span>(x0,sigma[<span class="dv">1</span>],N))<span class="co">#</span></span>
<span id="cb35-46"><a href="#cb35-46"></a><span class="kw">summary</span>(ts)[,<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">5</span>,<span class="dv">6</span>)]<span class="co">#</span></span>
<span id="cb35-47"><a href="#cb35-47"></a><span class="co">#</span></span>
<span id="cb35-48"><a href="#cb35-48"></a><span class="co">#In terms of time, the latter takes a lot less time</span></span>
<span id="cb35-49"><a href="#cb35-49"></a><span class="co">#</span></span></code></pre></div>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a><span class="co">#include &lt;Rcpp.h&gt;</span></span>
<span id="cb36-2"><a href="#cb36-2"></a>using namespace Rcpp;</span>
<span id="cb36-3"><a href="#cb36-3"></a><span class="op">/</span><span class="er">/</span><span class="st"> </span>[[Rcpp<span class="op">::</span>export]]</span>
<span id="cb36-4"><a href="#cb36-4"></a>List <span class="kw">rw_MetropolisC</span>(double x0, double sigma, int N) {</span>
<span id="cb36-5"><a href="#cb36-5"></a>  NumericVector <span class="kw">x</span>(N);</span>
<span id="cb36-6"><a href="#cb36-6"></a>  as<span class="op">&lt;</span>DoubleVector<span class="op">&gt;</span>(x)[<span class="dv">0</span>] =<span class="st"> </span>x0;</span>
<span id="cb36-7"><a href="#cb36-7"></a>  NumericVector <span class="kw">u</span>(N);</span>
<span id="cb36-8"><a href="#cb36-8"></a>  u =<span class="st"> </span>as<span class="op">&lt;</span>DoubleVector<span class="op">&gt;</span>(<span class="kw">runif</span>(N));</span>
<span id="cb36-9"><a href="#cb36-9"></a>  List <span class="kw">out</span>(<span class="dv">2</span>);</span>
<span id="cb36-10"><a href="#cb36-10"></a>  int k =<span class="st"> </span><span class="dv">1</span>;</span>
<span id="cb36-11"><a href="#cb36-11"></a>  <span class="cf">for</span>(int <span class="dt">i=</span><span class="dv">1</span>;i<span class="op">&lt;</span>(N<span class="dv">-1</span>);i<span class="op">++</span>){</span>
<span id="cb36-12"><a href="#cb36-12"></a>    double y =<span class="st"> </span>as<span class="op">&lt;</span>double<span class="op">&gt;</span>(<span class="kw">rnorm</span>(<span class="dv">1</span>,x[i<span class="dv">-1</span>],sigma));</span>
<span id="cb36-13"><a href="#cb36-13"></a>    <span class="cf">if</span>(u[i] <span class="op">&lt;=</span><span class="st"> </span><span class="kw">exp</span>(<span class="kw">abs</span>(x[i<span class="dv">-1</span>])<span class="op">-</span><span class="kw">abs</span>(y))){</span>
<span id="cb36-14"><a href="#cb36-14"></a>      x[i] =<span class="st"> </span>y;</span>
<span id="cb36-15"><a href="#cb36-15"></a>      k<span class="op">+</span><span class="er">=</span><span class="dv">1</span>;</span>
<span id="cb36-16"><a href="#cb36-16"></a>    }</span>
<span id="cb36-17"><a href="#cb36-17"></a>    <span class="cf">else</span>{</span>
<span id="cb36-18"><a href="#cb36-18"></a>      x[i] =<span class="st"> </span>x[i<span class="dv">-1</span>];</span>
<span id="cb36-19"><a href="#cb36-19"></a>    }</span>
<span id="cb36-20"><a href="#cb36-20"></a>  }  </span>
<span id="cb36-21"><a href="#cb36-21"></a>  out[<span class="dv">0</span>] =<span class="st"> </span>x;</span>
<span id="cb36-22"><a href="#cb36-22"></a>  out[<span class="dv">1</span>] =<span class="st"> </span>k;</span>
<span id="cb36-23"><a href="#cb36-23"></a>  <span class="kw">return</span>(out);</span>
<span id="cb36-24"><a href="#cb36-24"></a>}</span></code></pre></div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
